<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vertical Draggable Toolbar Demo</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
    }
    #myContainer {
      position: relative;
      width: 100%;
      height: 100vh;
      background: #f0f0f0;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="myContainer"></div>

  <script>
    
    function createVerticalDraggableToolbar(config, container, position = 'left') {
        const ensureTippy = async () => {
            const loadScript = (url) =>
                new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.async = true;
                script.onload = () => resolve();
                script.onerror = () => reject(`Failed to load ${url}`);
                document.head.appendChild(script);
                });

            const loadStyle = (url) =>
                new Promise((resolve, reject) => {
                const link = document.createElement('link');
                link.href = url;
                link.rel = 'stylesheet';
                link.onload = () => resolve();
                link.onerror = () => reject(`Failed to load ${url}`);
                document.head.appendChild(link);
                });

            const needsTippy = typeof window.tippy !== 'function';

            if (needsTippy) {
                await loadScript('https://unpkg.com/@popperjs/core@2');
                await loadScript('https://unpkg.com/tippy.js@6');
                await loadStyle('https://unpkg.com/tippy.js@6/dist/tippy.css');

                // Wait until window.tippy is available
                await new Promise((resolve) => {
                const check = () => {
                    if (typeof window.tippy === 'function') {
                    resolve();
                    } else {
                    setTimeout(check, 50);
                    }
                };
                check();
                });
            }
        };

      const loadResource = (type, url) => {
        return new Promise((resolve, reject) => {
          const el = type === 'script' ? document.createElement('script') : document.createElement('link');
          if (type === 'script') {
            el.src = url;
            el.async = true;
          } else {
            el.href = url;
            el.rel = 'stylesheet';
          }
          el.onload = () => resolve();
          el.onerror = () => reject(`Failed to load ${url}`);
          document.head.appendChild(el);
        });
      };

      const initToolbar = () => {
        const toolbar = document.createElement('div');
        toolbar.style.position = 'absolute';
        toolbar.style.top = '20px';
        toolbar.style[position] = '20px';
        toolbar.style.display = 'flex';
        toolbar.style.flexDirection = 'column';
        toolbar.style.gap = '12px';
        toolbar.style.background = '#fff';
        toolbar.style.border = '1px solid #ccc';
        toolbar.style.borderRadius = '4px';
        toolbar.style.padding = '6px';
        toolbar.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
        toolbar.style.zIndex = '9999';
        toolbar.style.cursor = 'grab';

        toolbar.setAttribute('draggable', 'true');

        config.buttons.forEach(btn => {
          const button = document.createElement('button');
          button.style.border = 'none';
          button.style.background = 'transparent';
          button.style.cursor = 'pointer';
          button.style.padding = '0';
          button.style.width = '32px';
          button.style.height = '32px';
          button.style.display = 'flex';
          button.style.alignItems = 'center';
          button.style.justifyContent = 'center';

          if (btn.svg) {
            button.innerHTML = btn.svg;
          } else if (btn.iconUrl) {
            const img = document.createElement('img');
            img.src = btn.iconUrl;
            img.alt = btn.tip;
            img.style.width = '100%';
            img.style.height = '100%';
            button.appendChild(img);
          }

          button.onclick = btn.onClick;
          toolbar.appendChild(button);

          window.tippy(button, {
            content: btn.tip,
            placement: 'right',
            animation: 'scale',
          });
        });

        let offsetX = 0, offsetY = 0;
        toolbar.addEventListener('dragstart', (e) => {
          const rect = toolbar.getBoundingClientRect();
          offsetX = e.clientX - rect.left;
          offsetY = e.clientY - rect.top;
        });

        container.addEventListener('dragover', (e) => e.preventDefault());

        container.addEventListener('drop', (e) => {
          e.preventDefault();
          const containerRect = container.getBoundingClientRect();
          const x = e.clientX - containerRect.left - offsetX;
          const y = e.clientY - containerRect.top - offsetY;
          toolbar.style.left = `${x}px`;
          toolbar.style.top = `${y}px`;
          toolbar.style.right = ''; // clear right if repositioned
        });

        container.appendChild(toolbar);
      };

      ensureTippy().then(initToolbar).catch(err => console.error('Toolbar setup failed:', err));
    }

    // Sample config
    const myToolbarConfig = {
      buttons: [
        {
            svg: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 576 512"><path fill="#000000" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"/></svg>`,
            tip: 'Home',
            onClick: () => alert('Clicked Green Dot'),
        },
        {
            svg: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#000000"><g fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" color="currentColor"><path d="M20.232 10.055c.48-.54 1.308-1.356 1.264-1.689c.034-.323-.141-.627-.491-1.234l-.494-.856c-.373-.648-.56-.972-.877-1.101c-.318-.13-.677-.028-1.395.176l-1.22.344c-.46.106-.94.046-1.359-.17l-.337-.194a2 2 0 0 1-.788-.968l-.334-.997c-.22-.66-.33-.99-.59-1.179C13.348 2 13 2 12.306 2h-1.114c-.695 0-1.042 0-1.303.188c-.262.19-.371.52-.591 1.18l-.334.996a2 2 0 0 1-.788.968l-.337.195c-.419.215-.9.275-1.359.169l-1.22-.344c-.718-.204-1.077-.306-1.395-.176c-.317.129-.504.453-.877 1.1l-.494.857c-.35.607-.525.911-.49 1.234c.033.323.267.584.736 1.105l1.03 1.152c.253.32.432.876.432 1.375c0 .5-.18 1.056-.431 1.375L2.74 14.526c-.469.521-.703.781-.737 1.105s.141.627.491 1.234l.494.856c.373.648.56.972.877 1.101c.318.13.677.028 1.395-.176l1.22-.344a2 2 0 0 1 1.36.17l.336.194c.359.23.635.569.788.968l.334.997c.22.66.34 1.003.541 1.148c.06.043.3.24.888.221M15 17.218s1 .284 1.5 1.284c0 0 1.096-2.5 2.508-3"/><path d="M22 16.999a5 5 0 1 1-10 0a5 5 0 0 1 10 0m-7.84-7.556c-.84-.684-1.5-.948-2.46-.948c-1.8.024-3.444 1.51-3.444 3.444c0 1.065.324 1.74.936 2.448"/></g></svg>`,
            tip: 'Settings',
            onClick: () => alert('Settings clicked'),
        },
        {
            svg: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 26 26"><path fill="#000000" d="M10 .188A9.812 9.812 0 0 0 .187 10A9.812 9.812 0 0 0 10 19.813c2.29 0 4.393-.811 6.063-2.125l.875.875a1.845 1.845 0 0 0 .343 2.156l4.594 4.625c.713.714 1.88.714 2.594 0l.875-.875a1.84 1.84 0 0 0 0-2.594l-4.625-4.594a1.824 1.824 0 0 0-2.157-.312l-.875-.875A9.812 9.812 0 0 0 10 .188zM10 2a8 8 0 1 1 0 16a8 8 0 0 1 0-16zM4.937 7.469a5.446 5.446 0 0 0-.812 2.875a5.46 5.46 0 0 0 5.469 5.469a5.516 5.516 0 0 0 3.156-1a7.166 7.166 0 0 1-.75.03a7.045 7.045 0 0 1-7.063-7.062c0-.104-.005-.208 0-.312z"/></svg>`,
            tip: 'Search',
            onClick: () => alert('Search clicked'),
        },
      ]
    };

    const containerDiv = document.getElementById('myContainer');
    createVerticalDraggableToolbar(myToolbarConfig, containerDiv, 'left');
  </script>
</body>
</html>