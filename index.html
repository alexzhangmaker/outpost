<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>outpost.PWA</title>
    <link rel="manifest" href="/outpost/manifest.json">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="./css/style.css">

    <link rel="stylesheet" href="./css/signpostToolkits.css">
    <link rel="stylesheet" href="./css/cssSchedule_V1.css">
    <link rel="stylesheet" href="./css/outpostCommon.css">
    <link rel="stylesheet" href="./css/componentOutpost.css">


    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
    <script src="./jsResource/localforage.min.js"></script>
    <script src="./jsResource/mousetrap.min.js"></script>
    <script src="./js/flowType.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>


    <style>
        @import url(https://fonts.googleapis.com/css?family=Open+Sans);
        @import url(https://fonts.googleapis.com/css?family=Lobster);
        @import url(https://fonts.googleapis.com/css?family=Oswald:400,700);

    </style>
    
</head>

<body>
    <div class="content" id="scrollableContent">
        <div id="idWndContent">
            <!-----
            <div class="editor">
                <input type="text" id="idInputMemo" name="fname"><br><br>
                <button onclick="onClickSubmitMemo()" id="idBTNSubmit"><i class="bi-journal-text outpostBTN"></i></button>
            </div>
            <div class="memoContainer"></div>
        -->
        </div>
    </div>
    
    <div class="navbar">
        <div class="nav-item"><i class="bi-list-task outpostBTN" id="idBTNToDo"></i>Home.todo</div>
        <div class="nav-item"><i class="bi-calendar-day outpostBTN" id="idBTNCMUSchedule"></i>schedule</div>
        <div class="nav-item"><i class="bi-envelope outpostBTN" id="idBTNMessage"></i>message</div>
        <div class="nav-item"><i class="bi-translate outpostBTN" id="idBTNDictAnywhere"></i>Dict.Anywhere</div>
        <!------
        <div class="nav-item"><i class="bi-cloud-arrow-down outpostBTN" id="idBTNSyncCloud"></i>Sync</div>
        ---->
        <div class="nav-item"><i class="bi-gear-wide-connected outpostBTN" id="idBTNSetting"></i>Settings</div>
    </div>

<script src="./js/outpost.js"></script>
<script src="./js/scheduleAPI.js"></script>
<script src="./js/firebaseAPI.js"></script>
<script src="./js/dictAnywhere.js"></script>
<script src="./js/todoAnywhere.js"></script>



<script>





async function _onClick_CMUSchedule(event){
    const firebaseUrl = "https://outpost-8d74e.asia-southeast1.firebasedatabase.app/CourseSchedule2025.json";
    let jsonCMUSchedule = [];
    const res = await fetch(firebaseUrl);
    jsonCMUSchedule = await res.json();
    console.log(jsonCMUSchedule) ;
    let tagWndContent = document.querySelector('#idWndContent') ;

    //renderSchedule(tagWndContent,jsonCMUSchedule);
    switchScheduleMode(tagWndContent,"Course TFL 2025") ;
    for(let i=0;i<jsonCMUSchedule.length;i++){
        renderCourseEvent(document.querySelector(".event-list"), jsonCMUSchedule[i]) ;
    }
    let weekday = getWeekday() ;
    const weekdayClassMap = {
        'Monday': 'scheduleMon',
        'Tuesday': 'scheduleTue',
        'Wednesday': 'scheduleWed',
        'Thursday': 'scheduleThurs',
        'Friday': 'scheduleFri',
        'Saturday': 'scheduleSat',
        'Sunday': 'scheduleSun'
    };
    let className = weekdayClassMap[weekday] ;
    let tagEventList = document.querySelector(".event-list") ;
    let tagWeekdayContainer = tagEventList.querySelector(`.${className}`) ;
    tagWeekdayContainer.open = true; 
    let tagWeekdays = tagEventList.querySelectorAll('.weekday');
    tagWeekdays.forEach(tagWeekday=>{
        if(tagWeekday.querySelectorAll('.eventV2').length==0){
            tagWeekday.classList.add('noShow') ;
        }
    }) ;
    //weekday
    //renderEvent(document.querySelector(".event-list"), jsonEvent1) ;
    //renderEvent(document.querySelector(".event-list"), jsonEvent2) ;
    
}


async function _onClick_Message(event){
    /*
    const firebaseUrl = "https://outpost-8d74e.asia-southeast1.firebasedatabase.app/CMUSchedule2025.json";
    let jsonCMUSchedule = [];
    const res = await fetch(firebaseUrl);
    jsonCMUCalendar = await res.json();
    console.log(jsonCMUCalendar) ;
    let tagWndContent = document.querySelector('#idWndContent') ;

    //renderSchedule(tagWndContent,jsonCMUSchedule);
    switchScheduleMode(tagWndContent,"CMU 2025") ;
    for(let i=0;i<jsonCMUCalendar.length;i++){
        renderCMUCalendarEvent(document.querySelector(".event-list"), jsonCMUCalendar[i]) ;
    }
    //renderEvent(document.querySelector(".event-list"), jsonEvent1) ;
    //renderEvent(document.querySelector(".event-list"), jsonEvent2) ;
    */
    let tagWndContent = document.querySelector('#idWndContent') ;
    tagWndContent.innerHTML=`
        <h2>message</h2>
    ` ;

}




async function _onClick_DictAnywhere(event){
    /*
    const firebaseUrl = "https://outpost-8d74e.asia-southeast1.firebasedatabase.app/CMUSchedule2025.json";
    let jsonCMUSchedule = [];
    const res = await fetch(firebaseUrl);
    jsonCMUCalendar = await res.json();
    console.log(jsonCMUCalendar) ;
    let tagWndContent = document.querySelector('#idWndContent') ;

    //renderSchedule(tagWndContent,jsonCMUSchedule);
    switchScheduleMode(tagWndContent,"CMU 2025") ;
    for(let i=0;i<jsonCMUCalendar.length;i++){
        renderCMUCalendarEvent(document.querySelector(".event-list"), jsonCMUCalendar[i]) ;
    }
    //renderEvent(document.querySelector(".event-list"), jsonEvent1) ;
    //renderEvent(document.querySelector(".event-list"), jsonEvent2) ;
    */
    let tagWndContent = document.querySelector('#idWndContent') ;
    tagWndContent.innerHTML=`
        <h2>Dict.Anywhere</h2>
    ` ;

}

async function _onClick_ToDo(event){
    //let cloudData = await _dumpFireStore("outpost") ;
    let tagWndContent = document.querySelector('#idWndContent') ;
    tagWndContent.innerHTML=`
        <div class="editor">
            <input type="text" id="idInputMemo" name="fname"><br><br>
            <button onclick="onClickSubmitMemo()" id="idBTNSubmit"><i class="bi-journal-text outpostBTN"></i></button>

        </div>
        <div class="memoContainer"></div>
    ` ;
    tagWndContent.querySelector('#idInputMemo').addEventListener('keydown',_onKeyInputEnter);
    renderLocalJSON() ;
}






async function _onDOMContentLoad(event){
    console.log('_onDOMContentLoad_') ;
}

</script>

<script>
function _parseStringToJSON(input) {
    // Regular expression to match patterns with optional date and about
    //const regex = /^(?:@(\d{2})(\d{2})(\d{4})\s+)?(?:\+(\w+)\s+)?(.+)$/;
      const regex = /^(?:@(\d{2})(\d{2})(\d{4})\s+)?(?:\+([\w.]+)\s+)?(.+)$/;

    // Match the input string
    const match = input.match(regex);
    
    if (!match) {
        throw new Error("Invalid input format");
    }
    
    // Extract components (month, day, year, about, memo)
    const [, month, day, year, about, memo] = match;
    
    // Get current date if date parts are missing
    const currentDate = new Date();
    
    // Construct JSON object
    let jsonData={
        date: {
            month: month ? parseInt(month) : currentDate.getMonth() + 1,
            day: day ? parseInt(day) : currentDate.getDate(),
            year: year ? parseInt(year) : currentDate.getFullYear()
        },
        about: about ? about.toLowerCase() : "all",
        memo: memo
    };
    let cDate = new Date(jsonData.date.year, jsonData.date.month, jsonData.date.day)
    jsonData.ttm=`${cDate.getTime()}` ;
    return jsonData ;
}

</script>
<script>
if ('serviceWorker' in navigator){
    navigator.serviceWorker.register('/outpost/service-worker.js').then(reg =>{ 
        console.log('Service Worker registered', reg) ;
    }).catch(err => {
        console.error('Service Worker registration failed', err) ;
    });
}
</script>
<script>
function flowType(element, options = {}) {
    const settings = {
    minimum: options.minimum || 500,
    maximum: options.maximum || 1200,
    minFont: options.minFont || 16,
    maxFont: options.maxFont || 40,
    fontRatio: options.fontRatio || 35
    };

    function adjustFontSize() {
        const width = element.offsetWidth;
        let fontSize = width / settings.fontRatio;

        fontSize = Math.max(settings.minFont, Math.min(fontSize, settings.maxFont));
        element.style.fontSize = fontSize + 'px';
    }

    window.addEventListener('resize', adjustFontSize);
    window.addEventListener('orientationchange', adjustFontSize);
    adjustFontSize(); // initial run
}

/*
make a contenteditable = true element to paste plain text only
*/
function handlePlainTextPaste(element) {
    element.addEventListener('paste', (event) => {
        // Prevent default paste behavior
        event.preventDefault();
        
        // Get plain text from clipboard
        const plainText = (event.clipboardData || window.clipboardData).getData('text/plain');
        
        // Set the plain text as innerText
        element.innerText = plainText;
    });
}
</script>

<script>

    document.addEventListener('DOMContentLoaded',_onDOMContentLoad) ;
    document.querySelector('#idBTNCMUSchedule').addEventListener('click',_onClick_CMUSchedule) ;
    document.querySelector('#idBTNMessage').addEventListener('click',_onClick_Message) ;
    document.querySelector('#idBTNToDo').addEventListener('click',_onClick_ToDo) ;
    document.querySelector('#idBTNDictAnywhere').addEventListener('click',_onClick_DictAnywhere) ;
    
    </script>
</body>
</html>