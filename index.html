<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>outpost.PWA</title>
    <link rel="manifest" href="/outpost/manifest.json">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="./css/style.css">

    <link rel="stylesheet" href="./css/signpostToolkits.css">
    <link rel="stylesheet" href="./css/cssSchedule_V1.css">
    <link rel="stylesheet" href="./css/outpostCommon.css">
    <link rel="stylesheet" href="./css/componentOutpost.css">


    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
    <script src="./jsResource/localforage.min.js"></script>
    <script src="./jsResource/mousetrap.min.js"></script>
    <script src="./js/flowType.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cleave.js@1.6.0/dist/cleave.min.js"></script>

    <style>
        @import url(https://fonts.googleapis.com/css?family=Open+Sans);
        @import url(https://fonts.googleapis.com/css?family=Lobster);
        @import url(https://fonts.googleapis.com/css?family=Oswald:400,700);

    </style>
    
</head>

<body>
    <div class="content" id="scrollableContent">
        <div id="idWndContent">
            <!-----
            <div class="editor">
                <input type="text" id="idInputMemo" name="fname"><br><br>
                <button onclick="onClickSubmitMemo()" id="idBTNSubmit"><i class="bi-journal-text outpostBTN"></i></button>
            </div>
            <div class="memoContainer"></div>
            -->
            <form id="dataForm" class="noShow">
                <input type="text" name="name" placeholder="Name" required>
                <input type="email" name="email" placeholder="Email" required>
                <input type="number" name="age" placeholder="Age" required>
                <button type="submit">Submit</button>
            </form>
            <div id="status" class="noShow">Ready</div>
        </div>
    </div>
    
    <div class="navbar">
        <div class="nav-item"><i class="bi-list-task outpostBTN" id="idBTNToDo"></i>Home.todo</div>
        <div class="nav-item"><i class="bi-calendar-day outpostBTN" id="idBTNCMUSchedule"></i>schedule</div>
        <div class="nav-item"><i class="bi-envelope outpostBTN" id="idBTNMessage"></i>message</div>
        <div class="nav-item"><i class="bi-translate outpostBTN" id="idBTNDictAnywhere"></i>Dict.Anywhere</div>
        <div class="nav-item"><i class="bi-safe outpostBTN" id="idBTNCloudSafe"></i>Storage</div>
        <div class="nav-item"><i class="bi-gear-wide-connected outpostBTN" id="idBTNSetting"></i>Settings</div>
    </div>

<script src="./js/outpostCommon.js"></script>
<script src="./js/scheduleAPI.js"></script>
<script src="./js/firebaseAPI.js"></script>
<script src="./js/dictAnywhere.js"></script>
<script src="./js/todoAnywhere.js"></script>



<script>





async function _onClick_CMUSchedule(event){
    const firebaseUrl = "https://outpost-8d74e.asia-southeast1.firebasedatabase.app/CourseSchedule2025.json";
    let jsonCMUSchedule = [];
    const res = await fetch(firebaseUrl);
    jsonCMUSchedule = await res.json();
    console.log(jsonCMUSchedule) ;
    let tagWndContent = document.querySelector('#idWndContent') ;

    //renderSchedule(tagWndContent,jsonCMUSchedule);
    switchScheduleMode(tagWndContent,"Course TFL 2025") ;
    for(let i=0;i<jsonCMUSchedule.length;i++){
        renderCourseEvent(document.querySelector(".event-list"), jsonCMUSchedule[i]) ;
    }
    let weekday = getWeekday() ;
    const weekdayClassMap = {
        'Monday': 'scheduleMon',
        'Tuesday': 'scheduleTue',
        'Wednesday': 'scheduleWed',
        'Thursday': 'scheduleThurs',
        'Friday': 'scheduleFri',
        'Saturday': 'scheduleSat',
        'Sunday': 'scheduleSun'
    };
    let className = weekdayClassMap[weekday] ;
    let tagEventList = document.querySelector(".event-list") ;
    let tagWeekdayContainer = tagEventList.querySelector(`.${className}`) ;
    tagWeekdayContainer.open = true; 
    let tagWeekdays = tagEventList.querySelectorAll('.weekday');
    tagWeekdays.forEach(tagWeekday=>{
        if(tagWeekday.querySelectorAll('.eventV2').length==0){
            tagWeekday.classList.add('noShow') ;
        }
    }) ;
    //weekday
    //renderEvent(document.querySelector(".event-list"), jsonEvent1) ;
    //renderEvent(document.querySelector(".event-list"), jsonEvent2) ;
    
}


async function _onClick_Message(event){
    /*
    const firebaseUrl = "https://outpost-8d74e.asia-southeast1.firebasedatabase.app/CMUSchedule2025.json";
    let jsonCMUSchedule = [];
    const res = await fetch(firebaseUrl);
    jsonCMUCalendar = await res.json();
    console.log(jsonCMUCalendar) ;
    let tagWndContent = document.querySelector('#idWndContent') ;

    //renderSchedule(tagWndContent,jsonCMUSchedule);
    switchScheduleMode(tagWndContent,"CMU 2025") ;
    for(let i=0;i<jsonCMUCalendar.length;i++){
        renderCMUCalendarEvent(document.querySelector(".event-list"), jsonCMUCalendar[i]) ;
    }
    //renderEvent(document.querySelector(".event-list"), jsonEvent1) ;
    //renderEvent(document.querySelector(".event-list"), jsonEvent2) ;
    */
    let tagWndContent = document.querySelector('#idWndContent') ;
    tagWndContent.innerHTML=`
        <h2>message</h2>
    ` ;

}




async function _onClick_DictAnywhere(event){
    let tagWndContent = document.querySelector('#idWndContent') ;
    _renderDictMode(tagWndContent) ;
}

async function _onClick_ToDo(event){
    //let cloudData = await _dumpFireStore("outpost") ;
    let tagWndContent = document.querySelector('#idWndContent') ;
    tagWndContent.innerHTML=`
        <div class="editor">
            <input type="text" id="idInputMemo" name="fname"><br><br>
            <button onclick="onClickSubmitMemo()" id="idBTNSubmit"><i class="bi-journal-text outpostBTN"></i></button>

        </div>
        <div class="memoContainer"></div>
    ` ;
    tagWndContent.querySelector('#idInputMemo').addEventListener('keydown',_onKeyInputEnter);
    renderLocalJSON() ;
}


async function _onDOMContentLoad(event){
    console.log('_onDOMContentLoad_') ;
}

</script>


<script>
    if ('serviceWorker' in navigator){
        navigator.serviceWorker.register('/outpost/service-worker.js').then(reg =>{ 
            console.log('Service Worker registered', reg) ;
        }).catch(err => {
            console.error('Service Worker registration failed', err) ;
        });
    }
</script>

<script>
    // Create a Web Worker
    const worker = new Worker("webWorker.js");

    // Handle form submission
    document.getElementById('dataForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = 'Submitting...';

      // Collect form data
      const formData = {
        name: e.target.name.value,
        email: e.target.email.value,
        age: Number(e.target.age.value)
      };

      // Send data to Web Worker
      //https://docs.google.com/spreadsheets/d/1kjywGY4dyxOCkEfAh_ynwgc2HUWA7lFXV8xU7lOYI2o/edit?gid=0#gid=0
      //sheetID = 1kjywGY4dyxOCkEfAh_ynwgc2HUWA7lFXV8xU7lOYI2o
      //google JSON2Sheet webAPP:
      //https://script.google.com/macros/s/AKfycbyjdTvx2NRFwwgQISNFnJE20m2C4-5kVwvoJK0ywUqLQOHxYuKVf45crOy_KbkYva2o/exec
      //https://script.google.com/macros/s/AKfycbyjdTvx2NRFwwgQISNFnJE20m2C4-5kVwvoJK0ywUqLQOHxYuKVf45crOy_KbkYva2o/exec
      //https://script.google.com/macros/library/d/1fzZG7YB-j5xvx3HnX1FPjWORoVzanBkknhRckRaAlxxgC_eioLScElum/1
      //test
      //curl -X POST -H "Content-Type: application/json" -d '{"name":"John Doe","email":"john@example.com","age":30}' "https://script.google.com/macros/s/AKfycbw9aEabZmGlfwVI_CbaMbLf3do3EH4guUAQtsX_lVQNeum6uWRM1F7Eplz7GInbSdn1/exec"
      //curl -L -X POST -H "Content-Type: application/json" -d '{"name":"John Doe","email":"john@example.com","age":30}' "https://script.google.com/macros/s/AKfycbw9aEabZmGlfwVI_CbaMbLf3do3EH4guUAQtsX_lVQNeum6uWRM1F7Eplz7GInbSdn1/exec"
      let url_gSheetWebApp = `https://script.google.com/macros/s/AKfycbw9aEabZmGlfwVI_CbaMbLf3do3EH4guUAQtsX_lVQNeum6uWRM1F7Eplz7GInbSdn1/exec` ;
      worker.postMessage({
        action: 'sendPost',
        url: url_gSheetWebApp, // Replace with your Google Apps Script Web App URL
        data: formData
      });
    });

    // Listen for messages from Web Worker
    worker.onmessage = (event) => {
      const statusDiv = document.getElementById('status');
      if (event.data.status === 'success') {
        statusDiv.textContent = 'Data saved successfully!';
      } else {
        statusDiv.textContent = `Error: ${event.data.message}`;
      }
    };

    // Handle worker errors
    worker.onerror = (error) => {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = `Worker error: ${error.message}`;
    };
</script>


<script>

document.addEventListener('DOMContentLoaded',_onDOMContentLoad) ;
document.querySelector('#idBTNCMUSchedule').addEventListener('click',_onClick_CMUSchedule) ;
document.querySelector('#idBTNMessage').addEventListener('click',_onClick_Message) ;
document.querySelector('#idBTNToDo').addEventListener('click',_onClick_ToDo) ;
document.querySelector('#idBTNDictAnywhere').addEventListener('click',_onClick_DictAnywhere) ;

</script>
</body>
</html>