<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt ç”Ÿæˆä¸æ•°æ®æ ¡éªŒç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    
     <script src="https://cdnjs.cloudflare.com/ajax/libs/ajv/8.1.0/ajv7.bundle.js"></script>

    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --console-bg: #1e1e1e;
            --console-text: #d4d4d4;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--dark-color);
            color: var(--light-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            display: flex;
            flex: 1;
        }
        
        /* å·¦ä¾§å¯¼èˆªæ  */
        .sidebar {
            width: 250px;
            background-color: var(--primary-color);
            padding: 20px 0;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
        }
        
        .logo {
            text-align: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .nav-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .nav-item:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .nav-item.active {
            background-color: var(--secondary-color);
            border-left: 4px solid var(--accent-color);
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .auth-section {
            display: flex;
            align-items: center;
        }
        
        /* æ§åˆ¶å°é£æ ¼å†…å®¹åŒº */
        .console-container {
            background-color: var(--console-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .console-header {
            background-color: var(--dark-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .console-title {
            font-weight: 600;
            color: var(--light-color);
        }
        
        .console-actions {
            display: flex;
            gap: 10px;
        }
        
        .console-body {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }
        
        .input-section, .output-section {
            background-color: rgba(255,255,255,0.05);
            border-radius: 6px;
            padding: 15px;
        }
        
        .section-title {
            margin-bottom: 15px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--light-color);
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            background-color: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            color: var(--light-color);
            font-size: 0.9rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
        }
        
        .prompt-container {
            background-color: rgba(0,0,0,0.3);
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            position: relative;
        }
        
        .prompt-text {
            font-family: monospace;
            white-space: pre-wrap;
            color: var(--console-text);
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-right: 5px;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .json-container {
            background-color: rgba(0,0,0,0.3);
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            min-height: 200px;
            font-family: monospace;
            white-space: pre-wrap;
            color: var(--console-text);
        }
        
        .validation-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        
        .validation-success {
            background-color: rgba(46, 204, 113, 0.2);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        
        .validation-error {
            background-color: rgba(231, 76, 60, 0.2);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }
        
        /* ç™»å½•ç•Œé¢ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: var(--dark-color);
        }
        
        .login-box {
            background-color: var(--primary-color);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        .login-message {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        
        .login-message.error {
            background-color: rgba(231, 76, 60, 0.2);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .logo h1, .sidebar .nav-item span {
                display: none;
            }
            
            .sidebar .nav-item {
                justify-content: center;
            }
            
            .sidebar .nav-item i {
                margin-right: 0;
            }
            
            .main-content {
                margin-left: 70px;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="loginContainer" class="login-container">
        <div class="login-box">
            <h2 class="login-title">AI Prompt ç³»ç»Ÿ</h2>
            <p style="text-align: center; margin-bottom: 20px;">è¯·ä½¿ç”¨æ‚¨çš„Gmailè´¦æˆ·ç™»å½•</p>
            <div class="form-group">
                <button id="googleLogin" class="btn btn-primary" style="width: 100%;">
                    <i class="fab fa-google"></i> ä½¿ç”¨ Google ç™»å½•
                </button>
            </div>
            <div id="loginMessage" class="login-message"></div>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨ç•Œé¢ -->
    <div id="appContainer" class="container" style="display: none;">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <div class="sidebar">
            <div class="logo">
                <h1>AI Prompt ç³»ç»Ÿ</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-template="enWordQuiz">
                    <i class="fas fa-box"></i>
                    <span>è‹±è¯­å•è¯Quiz</span>
                </li>
                <li class="nav-item" data-template="enGrammarQuiz">
                    <i class="fas fa-box"></i>
                    <span>è‹±è¯­è¯­æ³•Quiz</span>
                </li>

                
                <li class="nav-item" data-template="thaiWordsQuiz">
                    <i class="fas fa-box"></i>
                    <span>æ³°è¯­è¯æ±‡Quiz</span>
                </li>
                
                <li class="nav-item" data-template="enReadingCauseSolution">
                    <i class="fas fa-newspaper"></i>
                    <span>è‹±æ–‡é˜…è¯»-Cause&Solution</span>
                </li>
                
                <li class="nav-item" data-template="thReadingText">
                    <i class="fas fa-newspaper"></i>
                    <span>æ³°è¯­é˜…è¯»</span>
                </li>
                <li class="nav-item" data-template="article">
                    <i class="fas fa-newspaper"></i>
                    <span>æ–‡ç« æ‘˜è¦</span>
                </li>
                
                <li class="nav-item" data-template="thaiVocabulary">
                    <i class="fas fa-code"></i>
                    <span>æ³°è¯­å•è¯</span>
                </li>

                <li class="nav-item" data-template="noteWriting">
                    <i class="fas fa-code"></i>
                    <span>æ³°è¯­è¯­æ³•ç¬”è®°</span>
                </li>
                <li class="nav-item" data-template="schema">
                    <i class="fas fa-cogs"></i>
                    <span>Schema ç®¡ç†</span>
                </li>
            </ul>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="header">
                <div class="user-info">
                    <img id="userAvatar" src="" alt="ç”¨æˆ·å¤´åƒ">
                    <span id="userName">ç”¨æˆ·</span>
                </div>
                <div class="auth-section">
                    <button id="logoutBtn" class="btn btn-danger">
                        <i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•
                    </button>
                </div>
            </div>

            <div class="console-container">
                <div class="console-header">
                    <div class="console-title" id="consoleTitle">äº§å“ä¿¡æ¯ç”Ÿæˆ</div>
                    <div class="console-actions">
                        <button id="clearBtn" class="btn btn-warning">
                            <i class="fas fa-eraser"></i> æ¸…é™¤
                        </button>
                        <button id="helpBtn" class="btn btn-primary">
                            <i class="fas fa-question-circle"></i> å¸®åŠ©
                        </button>
                    </div>
                </div>
                
                <div class="console-body">
                    <!-- è¾“å…¥åŒºåŸŸ -->
                    <div class="input-section">
                        <h3 class="section-title">
                            <i class="fas fa-keyboard"></i> è¾“å…¥å…³é”®ä¿¡æ¯
                        </h3>
                        <div id="inputFields">
                            <!-- åŠ¨æ€ç”Ÿæˆçš„è¾“å…¥å­—æ®µ -->
                        </div>
                        <div class="prompt-container">
                            <div class="section-title">
                                <i class="fas fa-code"></i> ç”Ÿæˆçš„ Prompt
                            </div>
                            <div id="promptText" class="prompt-text">
                                <!-- ç”Ÿæˆçš„promptå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                            </div>
                            <button id="copyPromptBtn" class="btn btn-primary">
                                <i class="fas fa-copy"></i> å¤åˆ¶ Prompt
                            </button>
                        </div>
                    </div>
                    
                    <!-- è¾“å‡ºåŒºåŸŸ -->
                    <div class="output-section">
                        <h3 class="section-title">
                            <i class="fas fa-download"></i> AI è¾“å‡ºç»“æœ
                        </h3>
                        <div class="form-group">
                            <label for="aiOutput">ç²˜è´´ AI è¿”å›çš„ JSON æ•°æ®</label>
                            <textarea id="aiOutput" class="form-control" rows="8" placeholder="åœ¨æ­¤ç²˜è´´AIè¿”å›çš„JSONæ•°æ®..."></textarea>
                        </div>
                        
                        <div class="validation-result" id="validationResult">
                            <!-- éªŒè¯ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                        </div>
                        
                        <div class="action-buttons">
                            <button id="validateBtn" class="btn btn-warning">
                                <i class="fas fa-check-circle"></i> éªŒè¯ JSON
                            </button>
                            <button id="saveBtn" class="btn btn-success" disabled>
                                <i class="fas fa-save"></i> ä¿å­˜åˆ°æ•°æ®åº“
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // é¦–å…ˆæ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„Ajvå…¨å±€å˜é‡
        console.log('æ£€æŸ¥Ajvå…¨å±€å˜é‡:');
        console.log('- window.Ajv:', window.Ajv);
        console.log('- window.ajv:', window.ajv);
        console.log('- typeof Ajv:', typeof Ajv);
        //console.log('- typeof ajv:', typeof ajv);
        
        // æ£€æŸ¥æ˜¯å¦åœ¨windowå¯¹è±¡ä¸Šè®¾ç½®äº†å…¶ä»–å±æ€§
        console.log('æ£€æŸ¥windowå¯¹è±¡ä¸Šçš„Ajvç›¸å…³å±æ€§:');
        for (let key in window) {
            if (key.toLowerCase().includes('ajv') || key.toLowerCase().includes('validator')) {
                console.log(`- window.${key}:`, window[key]);
            }
        }

        const firebaseConfig = {
            apiKey: "AIzaSyA6MZ_p5lVuy8TMAqiuV6IRx9fggV44lQs",
            authDomain: "outpost-8d74e.firebaseapp.com",
            databaseURL: "https://outpost-dictionary-116208.asia-southeast1.firebasedatabase.app/",
            projectId: "outpost-8d74e",
            storageBucket: "outpost-8d74e.firebasestorage.app",
            messagingSenderId: "724993324937",
            appId: "1:724993324937:web:ce6c7e6b06489331c79358",
            measurementId: "G-QPHWRTH6BH"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); // Correct: auth() is the function
        const database = firebase.database();
        const provider = new firebase.auth.GoogleAuthProvider();

        // ç›´æ¥ä½¿ç”¨æ­£ç¡®çš„Ajvå˜é‡
        let ajv = null;
        let ajvAvailable = false;
        
        function initializeAjv() {
            try {
                console.log('åˆå§‹åŒ–Ajv...');
                
                // ç›´æ¥ä½¿ç”¨ window.ajv7
                if (typeof window.ajv7 === 'undefined') {
                    console.error('window.ajv7 æœªå®šä¹‰');
                    return false;
                }
                
                // åˆ›å»ºAjvå®ä¾‹
                ajv = new window.ajv7({
                    allErrors: true,
                    verbose: true,
                    strict: false,
                    coerceTypes: true
                });
                
                console.log('âœ… Ajvå®ä¾‹åˆ›å»ºæˆåŠŸ');
                
                // æ·»åŠ è‡ªå®šä¹‰æ ¼å¼éªŒè¯
                ajv.addFormat('option-id', {
                    type: 'string',
                    validate: (str) => /^[A-D]$/.test(str)
                });
                
                console.log('âœ… è‡ªå®šä¹‰æ ¼å¼éªŒè¯æ·»åŠ æˆåŠŸ');
                
                ajvAvailable = true;
                console.log('ğŸ‰ AjvéªŒè¯å™¨å·²å‡†å¤‡å°±ç»ªï¼');
                return true;
                
            } catch (error) {
                console.error('âŒ Ajvåˆå§‹åŒ–é”™è¯¯:', error);
                ajvAvailable = false;
                return false;
            }
        }

        // ç«‹å³åˆå§‹åŒ–Ajv
        ajvAvailable = initializeAjv();

        // ä½¿ç”¨Googleç™»å½•
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(result => {
                    // ç™»å½•æˆåŠŸ
                    const user = result.user;
                    if (user.email.endsWith('@gmail.com')) {
                        showApp();
                    } else {
                        auth.signOut();
                        showLoginMessage('é”™è¯¯ï¼šåªå…è®¸ä½¿ç”¨Gmailè´¦æˆ·ç™»å½•ã€‚', 'error');
                    }
                })
                .catch(error => {
                    console.error('ç™»å½•é”™è¯¯:', error);
                    showLoginMessage('ç™»å½•å¤±è´¥: ' + error.message, 'error');
                });
        }

        // é€€å‡ºç™»å½•
        function signOut() {
            auth.signOut();
        }

    </script>
    <script>
        const PromptTemplate_thaiWord=`è¯·ä¸ºæ³°è¯­å•è¯ "{thaiWord}" ç”Ÿæˆå®Œæ•´çš„è¯æ±‡å¡ç‰‡ä¿¡æ¯ã€‚
            è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›æ•°æ®ï¼ŒåŒ…å«æ‰€æœ‰å­—æ®µï¼š
            {
                "word_id": "ç”ŸæˆåŸºäºå•è¯çš„å”¯ä¸€ID",
                "thai": {
                    "word": "æ³°è¯­å•è¯",
                    "pronunciation": "æ³°è¯­å‘éŸ³ï¼ˆå›½é™…éŸ³æ ‡æˆ–æ‹¼éŸ³ï¼‰",
                    "spelling_breakdown": "æ‹¼å†™åˆ†è§£å’Œç»„æˆåˆ†æ"
                },
                "pos": "è¯æ€§ï¼ˆåè¯/åŠ¨è¯/å½¢å®¹è¯/å‰¯è¯ç­‰ï¼‰",
                "level": "CEFRçº§åˆ«ï¼ˆA1/A2/B1/B2/C1/C2ï¼‰",
                "topic": ["ç›¸å…³ä¸»é¢˜åˆ†ç±»1", "ç›¸å…³ä¸»é¢˜åˆ†ç±»2"],
                "definitions": [
                    {
                        "en": "è‹±æ–‡é‡Šä¹‰1",
                        "zh": "ä¸­æ–‡é‡Šä¹‰1"
                    },
                    {
                        "en": "è‹±æ–‡é‡Šä¹‰2", 
                        "zh": "ä¸­æ–‡é‡Šä¹‰2"
                    }
                ],
                "grammar_notes": "è¯¦ç»†çš„è¯­æ³•è¯´æ˜å’Œä½¿ç”¨è§„åˆ™",
                "conjugations": {
                    "è¿‡å»å¼": "è¿‡å»å¼å½¢å¼ï¼ˆå¦‚é€‚ç”¨ï¼‰",
                    "æœªæ¥å¼": "æœªæ¥å¼å½¢å¼ï¼ˆå¦‚é€‚ç”¨ï¼‰",
                    "å¦å®šå½¢å¼": "å¦å®šå½¢å¼ï¼ˆå¦‚é€‚ç”¨ï¼‰"
                },
                "common_phrases": [
                    {
                        "phrase": "åŒ…å«è¯¥å•è¯çš„å¸¸è§æ³°è¯­çŸ­è¯­1",
                        "translation": "çŸ­è¯­çš„ä¸­æ–‡ç¿»è¯‘1"
                    },
                    {
                        "phrase": "åŒ…å«è¯¥å•è¯çš„å¸¸è§æ³°è¯­çŸ­è¯­2",
                        "translation": "çŸ­è¯­çš„ä¸­æ–‡ç¿»è¯‘2"
                    }
                ],
                "synonyms": ["è¿‘ä¹‰è¯1", "è¿‘ä¹‰è¯2"],
                "antonyms": ["åä¹‰è¯1", "åä¹‰è¯2"],
                "tags": ["ç›¸å…³æ ‡ç­¾1", "ç›¸å…³æ ‡ç­¾2"]
            }

            è¦æ±‚ï¼š
            1. æ‰€æœ‰å­—æ®µéƒ½å¿…é¡»æä¾›ï¼Œä¸èƒ½ä¸ºç©º
            2. word_id è¯·åŸºäºæ³°è¯­å•è¯ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦
            3. pronunciation è¯·æä¾›å‡†ç¡®çš„å‘éŸ³æ ‡æ³¨
            4. spelling_breakdown è¯·åˆ†æå•è¯çš„æ‹¼å†™ç»“æ„
            5. definitions è‡³å°‘æä¾›2ä¸ªä¸åŒè§’åº¦çš„é‡Šä¹‰
            6. common_phrases è‡³å°‘æä¾›2ä¸ªå¸¸ç”¨çŸ­è¯­ä¾‹å­
            7. è¯·ç¡®ä¿æ‰€æœ‰ä¿¡æ¯å‡†ç¡®ä¸”ç¬¦åˆæ³°è¯­è¯­è¨€è§„èŒƒ
        ` ;

        const schema_thaiWord = {
            "type": "object",
            "properties": {
            "word_id": {
                "type": "string"
            },
            "thai": {
                "type": "object",
                "properties": {
                "word": { "type": "string" },
                "pronunciation": { "type": "string" },
                "spelling_breakdown": { "type": "string" }
                },
                "required": ["word", "pronunciation", "spelling_breakdown"],
                "additionalProperties": false
            },
            "pos": {
                "type": "string"
            },
            "level": {
                "type": "string",
                "enum": ["A1", "A2", "B1", "B2", "C1", "C2"]
            },
            "topic": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1
            },
            "definitions": {
                "type": "array",
                "items": {
                "type": "object",
                "properties": {
                    "en": { "type": "string" },
                    "zh": { "type": "string" }
                },
                "required": ["en", "zh"],
                "additionalProperties": false
                },
                "minItems": 1
            },
            "grammar_notes": {
                "type": "string"
            },
            "conjugations": {
                "type": "object",
                "patternProperties": {
                "^.*$": { "type": "string" }
                }
            },
            "common_phrases": {
                "type": "array",
                "items": {
                "type": "object",
                "properties": {
                    "phrase": { "type": "string" },
                    "translation": { "type": "string" }
                },
                "required": ["phrase", "translation"],
                "additionalProperties": false
                },
                "minItems": 1
            },
            "synonyms": {
                "type": "array",
                "items": { "type": "string" }
            },
            "antonyms": {
                "type": "array", 
                "items": { "type": "string" }
            },
            "tags": {
                "type": "array",
                "items": { "type": "string" }
            }
            },
            "required": [
            "word_id",
            "thai", 
            "pos",
            "level",
            "topic",
            "definitions",
            "grammar_notes",
            "conjugations",
            "common_phrases",
            "synonyms",
            "antonyms",
            "tags"
            ],
            "additionalProperties": false
        };
        
        const Prompt_Template_Quiz_En_Words=`ACT as an expert in English language assessment, specializing in creating materials for IELTS preparation. Your task is to generate a set of multiple-choice questions based on a given list of English words.

        **BACKGROUND:**
        The target audience is Chinese students with an IELTS level of approximately 6.5. The questions should reflect the language style and topics found in the IELTS Reading section.

        **TASK REQUIREMENTS:**

        1.  **Word Coverage:** For each word in the provided list, you must create TWO distinct questions:
            *   **Question Type 1: Meaning.** A question that tests the understanding of the word's definition.
            *   **Question Type 2: Usage.** A question that tests the correct use of the word in a sentence context.

        2.  **Question Content:**
            *   **For Meaning Questions:** The correct answer should be a clear and accurate definition or synonym. The distractors (incorrect options) should be plausible but incorrect definitions, which could include words with similar sounds, opposite meanings, or concepts that are tangentially related.
            *   **For Usage Questions:** Provide a sentence with a blank. The sentence should be coherent, of appropriate complexity for an IELTS 6.5 student, and related to common IELTS Reading topics (e.g., education, technology, environmental science, psychology, sociology, history). The correct answer must fit the sentence both grammatically and logically. The distractors should be words that might be mistakenly used in that context.

        3.  **Output Format:**
            *   You MUST output the results in a **valid JSON array**.
            *   Each question should be a JSON object with the following exact structure:

                {
                "question": "The question text goes here?",
                "options": [
                    {"id": "A", "text": "Option A text"},
                    {"id": "B", "text": "Option B text"},
                    {"id": "C", "text": "Option C text"},
                    {"id": "D", "text": "Option D text"}
                ],
                "correct_answer": "A" // (or B, C, D)
                }

            *   Please use English for all question and option texts.

        **EXAMPLE FORMAT:**
        Here is an example of the desired format for a single question (please note the language is English as required):

        {
        "question": "What is the meaning of 'sustainable'?",
        "options": [
            {"id": "A", "text": "Able to be maintained over the long term"},
            {"id": "B", "text": "Extremely profitable"},
            {"id": "C", "text": "Suddenly changing"},
            {"id": "D", "text": "Technologically advanced"}
        ],
        "correct_answer": "A"
        }

        **WORD LIST:**
            {EnWords}

        **FINALLY:**
        Generate the JSON array containing ALL questions. Ensure the questions are varied and of high quality.
` ;

        const Prompt_Template_EN_Grammar_Quiz= `
        **Act as** an expert IELTS test material writer. Your task is to create a set of 20 reading comprehension questions to test the identification of **{grmmarContent}**.

**Target Audience:** Chinese university freshmen with an IELTS level of approximately 6.0.

**Core Requirement:** Every question must be formatted as a **valid JSON array of objects**. The structure of each object MUST strictly follow the example template provided below.

**JSON Template Example:**
[
  {
    "question": "à¸„à¸³à¸§à¹ˆà¸² 'à¸•à¸£à¸‡à¸‚à¹‰à¸²à¸¡' à¸«à¸¡à¸²à¸¢à¸„à¸§à¸²à¸¡à¸§à¹ˆà¸²à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?",
    "options": [
      { "id": "A", "text": "optionA in English" },
      { "id": "B", "text": "optionB in English" },
      { "id": "C", "text": "optionC in English" },
      { "id": "D", "text": "optionD in English" }
    ],
    "correct_answer": "A"
  }
]

**Specific Instructions for the JSON Output:**

1.  **"question" Field:** Write a short reading passage (2-4 sentences) related to common IELTS themes (e.g., environment, technology, psychology, education, health). Embed {grmmarContent} within the text. The question itself must directly ask about this relationship.
2.  **"options" Field:**
    *   Provide exactly 4 options, each with an "id" ("A", "B", "C", "D") and a "text".
    *   The "text" for each option must be a complete, grammatically correct phrase or sentence in English.
    *   Only ONE option must be correct. The incorrect options (distractors) should be plausible but clearly wrong based on the passage.
3.  **"correct_answer" Field:** Provide the correct option's "id" as a single uppercase letter (e.g., "A", "B", "C", or "D").

**Content Themes (for context):** Ensure the topics of the reading passages are typical of IELTS Academic Reading, such as Environmental Science, Psychology, Sociology, Technology, History, or Health.

**Final Output Instruction:**
Your entire response must be **ONLY** the JSON array containing the 20 question objects, and nothing else. Do not include any introductory text, explanations, or notes outside the JSON structure.
`;

        const Prompt_Template_Th_Words_Quiz=`
        Generate a complete set of Thai vocabulary exercises in JSON format. For each given Thai word/phrase, create two multiple-choice questions:

**1. Meaning Comprehension Question:**
- Question format: "à¸„à¸³à¸§à¹ˆà¸² '[Thai word]' à¸«à¸¡à¸²à¸¢à¸„à¸§à¸²à¸¡à¸§à¹ˆà¸²à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?"
- Present 4 options in English
- Target A2 level Thai learners (Chinese students) learning B1 content

**2. Usage in Context Question:**
- Question format: "à¸›à¸£à¸°à¹‚à¸¢à¸„à¹ƒà¸”à¹ƒà¸Šà¹‰à¸„à¸³à¸§à¹ˆà¸² '[Thai word]' à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡"
- Present 4 complete Thai sentences as options
- Sentences must be appropriate for A2 level learners
- Only one sentence should correctly use the word

**Requirements:**
- Test level: A2 students learning B1 vocabulary
- All Thai sentences should use simple grammar and vocabulary suitable for A2 level
- Output format: Strict JSON Array following the exact structure below. Shuffle the sequence of the JSON array.
- Create these exercises for the following Thai words: [{thWords}]

**JSON Structure Example:**
[
        {
	
          "question": "à¸„à¸³à¸§à¹ˆà¸² 'à¸•à¸£à¸‡à¸‚à¹‰à¸²à¸¡' à¸«à¸¡à¸²à¸¢à¸„à¸§à¸²à¸¡à¸§à¹ˆà¸²à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?",
          "options": [
            {"id": "A", "text": "opposite"},
            {"id": "B", "text": "similar"},
            {"id": "C", "text": "behind"},
            {"id": "D", "text": "inside"}
          ],
          "correct_answer": "A"
        },
        {

          "question": "à¸›à¸£à¸°à¹‚à¸¢à¸„à¹ƒà¸”à¹ƒà¸Šà¹‰à¸„à¸³à¸§à¹ˆà¸² 'à¸•à¸£à¸‡à¸‚à¹‰à¸²à¸¡' à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡",
          "options": [
            {"id": "A", "text": "à¸šà¹‰à¸²à¸™à¸‰à¸±à¸™à¸­à¸¢à¸¹à¹ˆà¸•à¸£à¸‡à¸‚à¹‰à¸²à¸¡à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™"},
            {"id": "B", "text": "à¸‰à¸±à¸™à¸•à¸£à¸‡à¸‚à¹‰à¸²à¸¡à¹„à¸›à¹€à¸—à¸µà¹ˆà¸¢à¸§à¸à¸±à¸—à¸¢à¸²"},
            {"id": "C", "text": "à¸•à¸£à¸‡à¸‚à¹‰à¸²à¸¡à¸à¸´à¸™à¸‚à¹‰à¸²à¸§à¹à¸¥à¹‰à¸§"},
            {"id": "D", "text": "à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸­à¸¢à¸¹à¹ˆà¸•à¸£à¸‡à¸‚à¹‰à¸²à¸¡à¸šà¸™à¹‚à¸•à¹Šà¸°"}
          ],
          "correct_answer": "A"
        }
	//â€¦ questions for other words
      ]


Please maintain this exact JSON Array structure throughout the response.
` ;
        const schema_Quizzes_Choice1In4 = {
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "question": {
        "type": "string",
        "description": "The text of the question, which may include a blank or be a direct query about meaning or usage."
      },
      "options": {
        "type": "array",
        "description": "An array of possible answer choices for the question.",
        "items": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string",
              "description": "The unique identifier for the option (e.g., A, B, C, D).",
              "pattern": "^[A-D]$"
            },
            "text": {
              "type": "string",
              "description": "The textual content of the answer option."
            }
          },
          "required": ["id", "text"],
          "additionalProperties": false
        },
        "minItems": 4,
        "maxItems": 4
      },
      "correct_answer": {
        "type": "string",
        "description": "The ID of the correct option from the choices provided.",
        "pattern": "^[A-D]$"
      }
    },
    "required": ["question", "options", "correct_answer"],
    "additionalProperties": false
  },
  "minItems": 1
} ;

        const Prompt_Template_Note=`
        è¯·ä½ æ‰®æ¼”ä¸€ä½ä¸“ä¸šçš„æ³°è¯­è€å¸ˆï¼Œä¸ºä¸­æ–‡æ¯è¯­è€…ï¼ˆæ³°è¯­æ°´å¹³B1ï¼‰åˆ¶ä½œä¸€ä»½æ³°è¯­è¯­æ³•å­¦ä¹ ææ–™ã€‚

        è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ç”Ÿæˆå†…å®¹ï¼š

        **æ ¼å¼è¦æ±‚ï¼š**
        1.  ä½¿ç”¨Markdownæ ¼å¼ã€‚
        2.  æ•´ä¸ªæ–‡æ¡£åªæœ‰ä¸€ä¸ªä¸€çº§æ ‡é¢˜ "#"ï¼Œä½œä¸ºè¯¥è¯­æ³•ç‚¹çš„åç§°ã€‚
        3.  æ–‡æ¡£å†…å®¹å¿…é¡»åŒ…å«ä»¥ä¸‹å››ä¸ªäºŒçº§æ ‡é¢˜ "##"ï¼Œé¡ºåºä¸å¯æ”¹å˜ï¼š
            - "## è¯­æ³•æ„æˆ"
            - "## ç”¨é€”"
            - "## å¸¸ç”¨ä¾‹å¥"
            - '## ç»ƒä¹ "

        **å†…å®¹è¦æ±‚ï¼š**
        1.  **è¯­è¨€ï¼š** æ‰€æœ‰è§£é‡Šè¯´æ˜æ€§æ–‡å­—ï¼ˆæ ‡é¢˜ã€è¯­æ³•æ„æˆã€ç”¨é€”è¯´æ˜ï¼‰å¿…é¡»ä½¿ç”¨**ä¸­æ–‡**ã€‚
        2.  **æ³°è¯­åº”ç”¨ï¼š** è¯­æ³•ç»“æ„ã€ä¾‹å¥ã€ç»ƒä¹ é¢˜ç›®åŠç­”æ¡ˆä¸­çš„æ³°è¯­éƒ¨åˆ†å¿…é¡»ä½¿ç”¨**æ³°æ–‡**ã€‚
        3.  **è¯»è€…æ°´å¹³ï¼š** é¢å‘B1æ°´å¹³çš„ä¸­æ–‡å­¦ç”Ÿï¼Œè§£é‡Šéœ€æ¸…æ™°æ˜“æ‡‚ï¼Œä¾‹å¥è¦è´´è¿‘ç”Ÿæ´»ã€‚
        4.  **å„éƒ¨åˆ†ç»†åˆ™ï¼š**
            - **è¯­æ³•æ„æˆï¼š** æ¸…æ™°åˆ—å‡ºè¯¥è¯­æ³•ç‚¹çš„ç»“æ„å…¬å¼ï¼Œå¹¶ç®€è¦è¯´æ˜å„éƒ¨åˆ†æˆåˆ†ã€‚
            - **ç”¨é€”ï¼š** è§£é‡Šè¯¥è¯­æ³•åœ¨ä»€ä¹ˆæƒ…å¢ƒä¸‹ä½¿ç”¨ï¼Œè¡¨è¾¾ä»€ä¹ˆå«ä¹‰ã€‚
            - **å¸¸ç”¨ä¾‹å¥ï¼š** æä¾›3-5ä¸ªå…¸å‹ä¾‹å¥ï¼Œæ¯ä¸ªä¾‹å¥éœ€åŒ…å«æ³°æ–‡å’Œä¸­æ–‡ç¿»è¯‘ã€‚
            - **ç»ƒä¹ ï¼š** è®¾è®¡ä¸€ä¸ªç®€å•çš„ç»ƒä¹ ï¼Œä¾‹å¦‚å¡«ç©ºã€é€ å¥æˆ–æ”¹é”™ã€‚ç»ƒä¹ åè¯·é™„ä¸Šç­”æ¡ˆã€‚

        **è¯·ç”Ÿæˆçš„è¯­æ³•ç‚¹æ˜¯ï¼š{noteKeyPoint}**

        ç°åœ¨ï¼Œè¯·å¼€å§‹ç”Ÿæˆå…³äºã€è¯­æ³•ç‚¹ã€‘çš„Markdownå†…å®¹ã€‚
        `;

        const Prompt_Template_Article=`
        è¯·ä¸ºä»¥ä¸‹æ–‡ç« ç”Ÿæˆæ‘˜è¦ï¼š
        æ–‡ç« æ ‡é¢˜: {articleTitle}
        æ–‡ç« å†…å®¹: {articleContent}
        æ‘˜è¦é•¿åº¦: {summaryLength}

        è¯·ä»¥JSONæ ¼å¼è¿”å›ä»¥ä¸‹ç»“æ„çš„æ•°æ®ï¼š
        {
            "articleTitle": "æ–‡ç« æ ‡é¢˜",
            "summary": "æ–‡ç« æ‘˜è¦å†…å®¹",
            "keyPoints": ["è¦ç‚¹1", "è¦ç‚¹2", "è¦ç‚¹3"],
            "sentiment": "æ–‡ç« æƒ…æ„Ÿå€¾å‘",
            "readTime": "é¢„è®¡é˜…è¯»æ—¶é—´"
        }
        ` ;

        const Prompt_Template_En_Reading_CauseSolution=`
        **Objective:** Generate a complete IELTS-style reading practice exercise focused on a **Cause-Solution** text structure, tailored for a Chinese student currently at IELTS Band 6.0 but aiming for Band 6.5 in Reading and Writing.
## 1. User Context & Tone
*   The student is familiar with the IELTS format but needs to improve comprehension of complex argument structures and vocabulary.
*   The text and questions should challenge a Band 6.0 learner without being demotivating; the goal is structured practice leading to Band 6.5.
*   The topic should be about â€œ{textTopic}â€ which is academic but accessible, similar to those found in real IELTS exams .
## 2. Reading Text Specifications
*   **Length:** Approximately {textWords} words.
*   **Structure:** The text must have a clear **Cause-Solution** structure.
    *   **Paragraph 1:** Introduction to the problem.
    *   **Paragraph 2:** Detailed explanation of the **causes** or origins of the problem.
    *   **Paragraph 3:** Presentation and evaluation of proposed **solutions** or remedies.
    *   **Paragraph 4:** Conclusion (possibly discussing future implications or challenges).
*   **Language:**
    *   Use formal, academic English.
    *   Integrate a range of vocabulary suitable for Band 6.5 (e.g., precise nouns, strong verbs, topic-specific terminology).
    *   Include a mix of complex sentence structures (e.g., conditional clauses, passive voice, nominalization) but ensure overall coherence.
    *   **Explicitly use cause-effect and solution-signaling language** (e.g., "This is primarily due to...", "As a consequence,...", "One proposed remedy is...", "To mitigate this, governments could...").
## 3. Comprehension Questions Specifications
### Part A: 5W1H Questions (Focus on Gist & Detail)
Generate 5 questions based on the text to test basic comprehension. Each question should be a **Wh-** question (What, Why, Who, Where, When) or a **How** question. These should target main ideas and specific details.
*   Example formats: "What is the primary cause of X?", "How does Y contribute to the problem?", "Who is most affected by this issue?", "When did the problem become widespread?"
### Part B: Cause-Solution Analysis Questions (Focus on Analytical Reading)
Generate 3-4 questions that require the student to analyze the text's structure and argument. These should prepare them for the analytical thinking needed for Writing Task 2.
*   **Question 1 (Identifying Causes):** "According to the text, what are the **two** main causes of [the problem]?"
*   **Question 2 (Evaluating Solutions):** "What are the **potential limitations** of the solution proposed in paragraph 3?"
*   **Question 3 (Paraphrasing/Viewpoint):** "How does the author suggest that [a specific group] could address this challenge? Use your own words."
*   **(Optional) Question 4 (Vocabulary in Context):** Provide a sentence from the text with a challenging word or phrase bolded. Ask for a synonym or definition based on context.
## 4. Output Format Requirement
The output must be a single, valid JSON object. Use the following structure precisely:

{
  "topic": "Generated Topic Title",
  "reading_text": "Full word text here. Use \\n for line breaks between paragraphs.",
  "comprehension_questions": {
    "part_a": [
      "Question 1 text?",
      "Question 2 text?",
      "Question 3 text?",
      "Question 4 text?",
      "Question 5 text?"
    ],
    "part_b": [
      "Question 1 text?",
      "Question 2 text?",
      "Question 3 text?"
    ]
  },
  "answer_key": {
    "part_a": [
      "Answer to Question 1",
      "Answer to Question 2",
      "Answer to Question 3",
      "Answer to Question 4",
      "Answer to Question 5"
    ],
    "part_b": [
      "Answer to Question 1",
      "Answer to Question 2",
      "Answer to Question 3"
    ]
  }
}
` ;
const schema_En_Reading={
  "type": "object",
  "properties": {
    "topic": {
      "type": "string",
      "description": "The title or topic of the reading comprehension exercise"
    },
    "reading_text": {
      "type": "string",
      "description": "The full reading text content with \\n for line breaks between paragraphs"
    },
    "comprehension_questions": {
      "type": "object",
      "description": "Container for comprehension questions divided into parts",
      "properties": {
        "part_a": {
          "type": "array",
          "description": "Array of questions for part A",
          "items": {
            "type": "string",
            "description": "Individual question text"
          },
          "minItems": 1
        },
        "part_b": {
          "type": "array",
          "description": "Array of questions for part B",
          "items": {
            "type": "string",
            "description": "Individual question text"
          },
          "minItems": 1
        }
      },
      "required": ["part_a", "part_b"],
      "additionalProperties": false
    },
    "answer_key": {
      "type": "object",
      "description": "Container for answers corresponding to the questions",
      "properties": {
        "part_a": {
          "type": "array",
          "description": "Array of answers for part A questions",
          "items": {
            "type": "string",
            "description": "Individual answer text"
          },
          "minItems": 1
        },
        "part_b": {
          "type": "array",
          "description": "Array of answers for part B questions",
          "items": {
            "type": "string",
            "description": "Individual answer text"
          },
          "minItems": 1
        }
      },
      "required": ["part_a", "part_b"],
      "additionalProperties": false
    }
  },
  "required": ["topic", "reading_text", "comprehension_questions", "answer_key"],
  "additionalProperties": false
} ;


const Prompt_Th_Reading = `
**Role:** You are an expert in Teaching Thai as a Foreign Language (TFL). You specialize in creating pedagogical materials for Chinese native speakers.
**Task:** Create a comprehensive Thai reading exercise about â€œ{textTopic}â€ , tailored to a specific student profile.
**Student Profile:**
- **Native Language:** Chinese
- **Thai Proficiency:** {readerThaiLevel}.
- **Learning Focus:** Reading comprehension and vocabulary acquisition.
**Core Requirements:**
1.  **Text Content:**
    - **Topic:** {textTopic}.
    - **Level:** The main body of the text must use primarily B1-level grammar and sentence structures.
    - **Vocabulary:** Seamlessly integrate 10-12 key **B1-level vocabulary words** related to the topic . These words should be bolded (**) in the dialogue.
2.  **Comprehension Questions:**
    - Generate 6 reading comprehension questions based on the text.
    - Each question must be a **5W1H question** (Who, What, Where, When, Why, How).
    - Write the questions in Thai, appropriate for an A2-B1 level learner.
3.  **Vocabulary List:**
    - Provide a curated vocabulary list from the dialogue.
    - **Inclusion Criteria:** All B1-level words (the ones you bolded) + 5-7 other relevant A2-level words that are crucial for understanding the text.
    - **Format for each word:** Present in a table-like format. For each word, include:
        - **Thai Word:** The target vocabulary.
        - **Part of Speech:** (n.), (v.), (adj.), etc.
        - **English Meaning:** A simple, clear definition.
        - **Chinese Meaning:** The Mandarin translation (æ‹¼éŸ³ - pinyin and æ±‰å­— - characters). *[This is crucial for the student's native language support]*.
**Output Format Instructions:**
You MUST output a single, valid JSON object. Do not include any other text or explanations before or after the JSON object. 
The JSON structure must be exactly as follows:
  {
    "article_title": "A short, engaging title for the reading exercise in Thai",
    "article_thai_content": "The full Thai dialogue text. B1 words must be wrapped in **double asterisks** for emphasis.",
    "article_english_translation": "A natural English translation of the Thai dialogue.",
    "comprehension_questions": [
      {
        "type": "What",
        "question_thai": "First question in Thai",
        "question_english": "English translation of the first question"
      },
      {
        "type": "Where",
        "question_thai": "Second question in Thai",
        "question_english": "English translation of the second question"
      }// ... include 5 questions total for each 5W1H type.
    ],
    "vocabulary_list": [
      {
        "thai_word": "à¸à¸²à¸£à¹à¸‚à¹ˆà¸‡à¸‚à¸±à¸™",
        "part_of_speech": "n.",
        "english_meaning": "competition, match",
        "chinese_meaning_pinyin": "jÃ¬ngsÃ i",
        "chinese_meaning_characters": "ç«èµ›"
      },// ... include all vocabulary words here.
    ]
  }

` ;
const schema_Thai_Reading = {
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Thai Reading Comprehension Exercise",
  "description": "Schema for Thai reading comprehension exercises with bilingual content and vocabulary",
  "type": "object",
  "properties": {
    "article_title": {
      "type": "string",
      "description": "A short, engaging title for the reading exercise in Thai",
      "minLength": 1,
      "maxLength": 100
    },
    "article_thai_content": {
      "type": "string",
      "description": "The full Thai dialogue text with B1 words wrapped in **double asterisks** for emphasis",
      "minLength": 50
    },
    "article_english_translation": {
      "type": "string",
      "description": "A natural English translation of the Thai dialogue",
      "minLength": 50
    },
    "comprehension_questions": {
      "type": "array",
      "description": "Array of comprehension questions covering 5W1H types",
      "items": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Question type (What, Where, When, Why, Who, How)",
            "enum": ["What", "Where", "When", "Why", "Who", "How"]
          },
          "question_thai": {
            "type": "string",
            "description": "Question text in Thai",
            "minLength": 5
          },
          "question_english": {
            "type": "string",
            "description": "English translation of the question",
            "minLength": 5
          }
        },
        "required": ["type", "question_thai", "question_english"],
        "additionalProperties": false
      },
      "minItems": 6,
      "maxItems": 12
    },
    "vocabulary_list": {
      "type": "array",
      "description": "List of vocabulary words from the article",
      "items": {
        "type": "object",
        "properties": {
          "thai_word": {
            "type": "string",
            "description": "Thai vocabulary word",
            "minLength": 1
          },
          "part_of_speech": {
            "type": "string",
            "description": "Part of speech abbreviation",
            "pattern": "^[a-zA-Z]+\\.?$"
          },
          "english_meaning": {
            "type": "string",
            "description": "English meaning of the word",
            "minLength": 1
          },
          "chinese_meaning_pinyin": {
            "type": "string",
            "description": "Chinese meaning in pinyin",
            "pattern": "^[a-zA-Z\\s]+$"
          },
          "chinese_meaning_characters": {
            "type": "string",
            "description": "Chinese meaning in characters",
            "pattern": "^[\\u4e00-\\u9fff]+$"
          }
        },
        "required": ["thai_word", "part_of_speech", "english_meaning"],
        "additionalProperties": false
      },
      "minItems": 3
    }
  },
  "required": [
    "article_title",
    "article_thai_content",
    "article_english_translation",
    "comprehension_questions",
    "vocabulary_list"
  ],
  "additionalProperties": false
};
    </script>
    <script>
        
        
        // åº”ç”¨çŠ¶æ€
        const appState = {
            currentUser: null,
            currentTemplate: 'product',
            templates: {
                thaiVocabulary: {
                    name: 'æ³°è¯­è¯æ±‡ç”Ÿæˆ',
                    fields: [
                        { id: 'thaiWord', label: 'æ³°è¯­å•è¯', type: 'text', required: true }
                    ],
                    promptTemplate: PromptTemplate_thaiWord,
                    schema: schema_thaiWord
                },
                enWordQuiz: {
                    name: 'è‹±è¯­è¯æ±‡Quiz',
                    fields: [
                        { id: 'EnWords', label: 'å•è¯åˆ—è¡¨', type: 'text', required: true }
                    ],
                    promptTemplate: Prompt_Template_Quiz_En_Words,
                    schema: schema_Quizzes_Choice1In4
                },
                enGrammarQuiz:{
                    name: 'è‹±è¯­è¯­æ³•Quiz',
                    fields: [
                        { id: 'grmmarContent', label: 'è¯­æ³•è¦ç‚¹', type: 'text', required: true },
                        { id: 'grmmarContent', label: 'è¯­æ³•è¦ç‚¹', type: 'text', required: true }

                    ],
                    promptTemplate: Prompt_Template_EN_Grammar_Quiz,
                    schema: schema_Quizzes_Choice1In4
                },//
                 thaiWordsQuiz:{
                    name: 'æ³°è¯­å•è¯Quiz',
                    fields: [
                        { id: 'thWords', label: 'æ³°è¯­å•è¯æ¸…å•', type: 'text', required: true }

                    ],
                    promptTemplate: Prompt_Template_Th_Words_Quiz,
                    schema: schema_Quizzes_Choice1In4
                },
                
                enReadingCauseSolution:{
                    name: 'è‹±æ–‡é˜…è¯»-Cause&Solution',
                    fields: [
                        { id: 'textTopic', label: 'æ–‡ç« æ ‡é¢˜', type: 'text', required: true },
                        { id: 'textWords', label: 'æ–‡ç« å­—æ•°', type: 'text', required: true }
                    ],
                    promptTemplate: Prompt_Template_En_Reading_CauseSolution,
                    schema: schema_En_Reading
                },//
                

                thReadingText:{
                    name: 'æ³°æ–‡é˜…è¯»',
                    fields: [
                        { id: 'textTopic', label: 'æ–‡ç« æ ‡é¢˜', type: 'text', required: true },
                        { id: 'readerThaiLevel', label: 'æ–‡ç« å­—æ•°', type: 'text', required: true },
                        { id: 'textTopic', label: 'æ–‡ç« æ ‡é¢˜', type: 'text', required: true },
                    ],
                    promptTemplate: Prompt_Th_Reading,
                    schema: schema_Thai_Reading
                },//Prompt_Th_Reading
                article: {
                    name: 'æ–‡ç« æ‘˜è¦',
                    fields: [
                        { id: 'articleTitle', label: 'æ–‡ç« æ ‡é¢˜', type: 'text', required: true },
                        { id: 'articleContent', label: 'æ–‡ç« å†…å®¹', type: 'textarea', required: true },
                        { id: 'summaryLength', label: 'æ‘˜è¦é•¿åº¦', type: 'select', options: ['çŸ­', 'ä¸­', 'é•¿'], required: true }
                    ],
                    promptTemplate: Prompt_Template_Article,
                    schema: {
                        type: "object",
                        properties: {
                            articleTitle: { type: "string" },
                            summary: { type: "string" },
                            keyPoints: { type: "array", items: { type: "string" } },
                            sentiment: { type: "string" },
                            readTime: { type: "string" }
                        },
                        required: ["articleTitle", "summary", "keyPoints", "sentiment", "readTime"]
                    }
                },
                noteWriting:{
                    name: 'æ³°è¯­è¯­æ³•ç¬”è®°',
                    fields: [
                        { id: 'noteKeyPoint', label: 'noteè¦ç‚¹', type: 'text', required: true },
                       
                    ],
                    promptTemplate: Prompt_Template_Note
                }
            }
        };

        // DOM å…ƒç´ 
        const loginContainer = document.getElementById('loginContainer');
        const appContainer = document.getElementById('appContainer');
        const googleLoginBtn = document.getElementById('googleLogin');
        const logoutBtn = document.getElementById('logoutBtn');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const navItems = document.querySelectorAll('.nav-item');
        const inputFields = document.getElementById('inputFields');
        const promptText = document.getElementById('promptText');
        const copyPromptBtn = document.getElementById('copyPromptBtn');
        const aiOutput = document.getElementById('aiOutput');
        const validateBtn = document.getElementById('validateBtn');
        const saveBtn = document.getElementById('saveBtn');
        const validationResult = document.getElementById('validationResult');
        const clearBtn = document.getElementById('clearBtn');
        const consoleTitle = document.getElementById('consoleTitle');

        
       // åŸºäºAjvçš„éªŒè¯å‡½æ•°
        function validateJsonSchema(data, schema) {
            if (!ajvAvailable || !ajv) {
                console.log('ä½¿ç”¨å¤‡ç”¨éªŒè¯å™¨');
                return fallbackValidateJsonSchema(data, schema);
            }
            
            try {
                console.log('ä½¿ç”¨Ajvè¿›è¡Œå®Œæ•´éªŒè¯...');
                const validate = ajv.compile(schema);
                const valid = validate(data);
                
                if (valid) {
                    return {
                        valid: true,
                        errors: [],
                        validator: 'ajv'
                    };
                } else {
                    const formattedErrors = validate.errors.map(error => {
                        const path = error.instancePath ? `å­—æ®µ ${error.instancePath}` : 'æ ¹çº§åˆ«';
                        let message = `${path} ${error.message}`;
                        
                        if (error.params) {
                            if (error.params.allowedValues) {
                                message += `ï¼Œå…è®¸çš„å€¼: ${JSON.stringify(error.params.allowedValues)}`;
                            }
                            if (error.params.additionalProperty) {
                                message += `ï¼Œä¸å…è®¸çš„å±æ€§: "${error.params.additionalProperty}"`;
                            }
                            if (error.params.missingProperty) {
                                message += `ï¼Œç¼ºå°‘å±æ€§: "${error.params.missingProperty}"`;
                            }
                        }
                        return message;
                    });
                    
                    return {
                        valid: false,
                        errors: formattedErrors,
                        validator: 'ajv'
                    };
                }
            } catch (error) {
                console.error('AjvéªŒè¯è¿‡ç¨‹å‡ºé”™:', error);
                return fallbackValidateJsonSchema(data, schema);
            }
        }

        // å¤‡ç”¨éªŒè¯å‡½æ•°
        function fallbackValidateJsonSchema(data, schema) {
            const errors = [];
            
            // æ£€æŸ¥å¿…éœ€å­—æ®µ
            if (schema.required) {
                for (const field of schema.required) {
                    if (data[field] === undefined || data[field] === null) {
                        errors.push(`ç¼ºå°‘å¿…éœ€å­—æ®µ: ${field}`);
                    }
                }
            }
            
            // æ£€æŸ¥å­—æ®µç±»å‹
            if (schema.properties) {
                for (const [field, definition] of Object.entries(schema.properties)) {
                    if (data[field] !== undefined) {
                        const value = data[field];
                        
                        switch (definition.type) {
                            case 'string':
                                if (typeof value !== 'string') {
                                    errors.push(`å­—æ®µ ${field} åº”è¯¥æ˜¯å­—ç¬¦ä¸²ç±»å‹`);
                                }
                                break;
                            case 'array':
                                if (!Array.isArray(value)) {
                                    errors.push(`å­—æ®µ ${field} åº”è¯¥æ˜¯æ•°ç»„ç±»å‹`);
                                } else if (definition.minItems && value.length < definition.minItems) {
                                    errors.push(`å­—æ®µ ${field} è‡³å°‘éœ€è¦ ${definition.minItems} ä¸ªå…ƒç´ `);
                                } else if (definition.maxItems && value.length > definition.maxItems) {
                                    errors.push(`å­—æ®µ ${field} æœ€å¤šåªèƒ½æœ‰ ${definition.maxItems} ä¸ªå…ƒç´ `);
                                }
                                break;
                            case 'object':
                                if (typeof value !== 'object' || Array.isArray(value)) {
                                    errors.push(`å­—æ®µ ${field} åº”è¯¥æ˜¯å¯¹è±¡ç±»å‹`);
                                }
                                break;
                        }
                    }
                }
            }
            
            return {
                valid: errors.length === 0,
                errors: errors,
                validator: 'fallback'
            };
        }

        // éªŒè¯JSONæ•°æ®
        function validateJsonWithDetails() {
            const jsonText = aiOutput.value.trim();
            
            if (!jsonText) {
                showValidationResult('é”™è¯¯ï¼šè¯·è¾“å…¥JSONæ•°æ®ã€‚', false);
                return null;
            }
            
            try {
                const jsonData = JSON.parse(jsonText);
                const template = appState.templates[appState.currentTemplate];
                
                if (!template.schema) {
                    showValidationResult('è­¦å‘Šï¼šå½“å‰æ¨¡æ¿æ²¡æœ‰å®šä¹‰Schemaï¼Œè·³è¿‡éªŒè¯ã€‚', true);
                    return jsonData;
                }
                
                const validationResult = validateJsonSchema(jsonData, template.schema);
                
                let message;
                if (validationResult.valid) {
                    if (validationResult.validator === 'ajv') {
                        message = 'âœ… éªŒè¯æˆåŠŸï¼ˆä½¿ç”¨AjvéªŒè¯å™¨ï¼‰ï¼šJSONæ•°æ®å®Œå…¨ç¬¦åˆSchemaè¦æ±‚ã€‚';
                    } else {
                        message = 'âš ï¸ éªŒè¯æˆåŠŸï¼ˆä½¿ç”¨å¤‡ç”¨éªŒè¯å™¨ï¼‰ï¼šJSONæ•°æ®åŸºæœ¬ç¬¦åˆSchemaè¦æ±‚ã€‚';
                    }
                    showValidationResult(message, true);
                    saveBtn.disabled = false;
                    return jsonData;
                } else {
                    const validatorName = validationResult.validator === 'ajv' ? 'AjvéªŒè¯å™¨' : 'å¤‡ç”¨éªŒè¯å™¨';
                    const errorDetails = validationResult.errors.join('\nâ€¢ ');
                    message = `âŒ éªŒè¯å¤±è´¥ï¼ˆä½¿ç”¨${validatorName}ï¼‰ï¼š\nâ€¢ ${errorDetails}`;
                    showValidationResult(message, false);
                    saveBtn.disabled = true;
                    return null;
                }
            } catch (error) {
                showValidationResult(`âŒ JSONè§£æé”™è¯¯ï¼š${error.message}`, false);
                saveBtn.disabled = true;
                return null;
            }
        }
        

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
            auth.onAuthStateChanged(user => {
                if (user && user.emailVerified && user.email.endsWith('@gmail.com')) {
                    // ç”¨æˆ·å·²ç™»å½•ä¸”æ˜¯Gmailè´¦æˆ·
                    appState.currentUser = user;
                    showApp();
                } else {
                    // ç”¨æˆ·æœªç™»å½•æˆ–ä¸æ˜¯Gmailè´¦æˆ·
                    appState.currentUser = null;
                    showLogin();
                }
            });

            // äº‹ä»¶ç›‘å¬å™¨
            googleLoginBtn.addEventListener('click', signInWithGoogle);
            logoutBtn.addEventListener('click', signOut);
            
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    // æ›´æ–°æ´»åŠ¨å¯¼èˆªé¡¹
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    // æ›´æ–°å½“å‰æ¨¡æ¿
                    const templateId = item.getAttribute('data-template');
                    if (templateId === 'schema') {
                        showSchemaManager();
                    } else {
                        switchTemplate(templateId);
                    }
                });
            });
            
            copyPromptBtn.addEventListener('click', copyPromptToClipboard);
            validateBtn.addEventListener('click', validateJson);
            saveBtn.addEventListener('click', saveToDatabase);
            clearBtn.addEventListener('click', clearForm);
            
            // è¾“å…¥å­—æ®µå˜åŒ–æ—¶æ›´æ–°prompt
            inputFields.addEventListener('input', updatePrompt);
            
            // åˆå§‹åŒ–é»˜è®¤æ¨¡æ¿
            //switchTemplate('product');

            // æ˜¾ç¤ºAjvçŠ¶æ€
            if (ajvAvailable) {
                console.log('âœ… AjvéªŒè¯å™¨å·²å°±ç»ªï¼Œå¯ä»¥è¿›è¡Œå®Œæ•´éªŒè¯');
            } else {
                console.log('âš ï¸ ä½¿ç”¨å¤‡ç”¨éªŒè¯å™¨');
            }
        }

        
        // æ˜¾ç¤ºç™»å½•ç•Œé¢
        function showLogin() {
            loginContainer.style.display = 'flex';
            appContainer.style.display = 'none';
        }

        // æ˜¾ç¤ºåº”ç”¨ç•Œé¢
        function showApp() {
            loginContainer.style.display = 'none';
            appContainer.style.display = 'flex';
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            if (appState.currentUser) {
                userAvatar.src = appState.currentUser.photoURL || 'https://via.placeholder.com/40';
                userName.textContent = appState.currentUser.displayName || appState.currentUser.email;
            }
        }

        // æ˜¾ç¤ºç™»å½•æ¶ˆæ¯
        function showLoginMessage(message, type) {
            const loginMessage = document.getElementById('loginMessage');
            loginMessage.textContent = message;
            loginMessage.className = `login-message ${type}`;
            loginMessage.style.display = 'block';
        }

        // åˆ‡æ¢æ¨¡æ¿
        function switchTemplate(templateId) {
            if (!appState.templates[templateId]) return;
            
            appState.currentTemplate = templateId;
            const template = appState.templates[templateId];
            
            // æ›´æ–°æ§åˆ¶å°æ ‡é¢˜
            consoleTitle.textContent = template.name;
            
            // ç”Ÿæˆè¾“å…¥å­—æ®µ
            generateInputFields(template.fields);
            
            // æ›´æ–°prompt
            updatePrompt();
            
            // æ¸…é™¤ä¹‹å‰çš„éªŒè¯ç»“æœ
            clearValidation();
            
            // ç¡®ä¿è¾“å‡ºåŒºåŸŸå¯è§
            document.querySelector('.output-section').style.display = 'block';
        }

        // ç”Ÿæˆè¾“å…¥å­—æ®µ
        function generateInputFields(fields) {
            inputFields.innerHTML = '';
            
            fields.forEach(field => {
                const formGroup = document.createElement('div');
                formGroup.className = 'form-group';
                
                const label = document.createElement('label');
                label.textContent = field.label + (field.required ? ' *' : '');
                label.setAttribute('for', field.id);
                
                let input;
                if (field.type === 'textarea') {
                    input = document.createElement('textarea');
                    input.rows = 4;
                } else if (field.type === 'select') {
                    input = document.createElement('select');
                    field.options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        input.appendChild(optionElement);
                    });
                } else {
                    input = document.createElement('input');
                    input.type = field.type;
                }
                
                input.id = field.id;
                input.className = 'form-control';
                input.placeholder = `è¯·è¾“å…¥${field.label}`;
                
                formGroup.appendChild(label);
                formGroup.appendChild(input);
                inputFields.appendChild(formGroup);
            });
        }

        // æ›´æ–°prompt
        function updatePrompt() {
            const template = appState.templates[appState.currentTemplate];
            let prompt = template.promptTemplate;
            
            // æ›¿æ¢å ä½ç¬¦
            template.fields.forEach(field => {
                const input = document.getElementById(field.id);
                if (input) {
                    const value = input.value || `[${field.label}]`;
                    prompt = prompt.replace(`{${field.id}}`, value);
                }
            });
            
            promptText.textContent = prompt;
        }

        // å¤åˆ¶promptåˆ°å‰ªè´´æ¿
        function copyPromptToClipboard() {
            navigator.clipboard.writeText(promptText.textContent)
                .then(() => {
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    const originalText = copyPromptBtn.innerHTML;
                    copyPromptBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                    setTimeout(() => {
                        copyPromptBtn.innerHTML = originalText;
                    }, 2000);
                })
                .catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥: ', err);
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶æ–‡æœ¬ã€‚');
                });
        }

        
       
         // ä¿®æ”¹åŸæœ‰çš„validateJsonå‡½æ•°æ¥ä½¿ç”¨æ–°çš„éªŒè¯é€»è¾‘
        function validateJson() {
            validateJsonWithDetails();
        }

        // æ˜¾ç¤ºéªŒè¯ç»“æœ
        function showValidationResult(message, isSuccess) {
            validationResult.textContent = message;
            validationResult.className = `validation-result ${isSuccess ? 'validation-success' : 'validation-error'}`;
            validationResult.style.display = 'block';
        }

        // æ¸…é™¤éªŒè¯ç»“æœ
        function clearValidation() {
            validationResult.style.display = 'none';
            saveBtn.disabled = true;
        }


        /*
        // ä¿å­˜åˆ°æ•°æ®åº“
        function saveToDatabase() {
            const jsonText = aiOutput.value.trim();
            
            if (!jsonText) {
                alert('é”™è¯¯ï¼šæ²¡æœ‰å¯ä¿å­˜çš„æ•°æ®ã€‚');
                return;
            }
            
            try {
                const jsonData = JSON.parse(jsonText);
                const template = appState.templates[appState.currentTemplate];
                
                // ä½¿ç”¨è‡ªå®šä¹‰éªŒè¯å‡½æ•°å†æ¬¡éªŒè¯
                const validationResult = validateJsonSchema(jsonData, template.schema);
                
                if (!validationResult.valid) {
                    alert('é”™è¯¯ï¼šæ•°æ®éªŒè¯å¤±è´¥ï¼Œè¯·é‡æ–°éªŒè¯ã€‚');
                    return;
                }
                
                // ç”Ÿæˆå”¯ä¸€ID
                const dataId = Date.now().toString();
                
                // å‡†å¤‡ä¿å­˜çš„æ•°æ®
                const saveData = {
                    ...jsonData,
                    _metadata: {
                        template: appState.currentTemplate,
                        createdAt: new Date().toISOString(),
                        createdBy: appState.currentUser.uid,
                        createdByName: appState.currentUser.displayName || appState.currentUser.email
                    }
                };
                
                // ä¿å­˜åˆ°Firebase
                database.ref(`ai-data/${appState.currentUser.uid}/${appState.currentTemplate}/${dataId}`)
                    .set(saveData)
                    .then(() => {
                        alert('æ•°æ®ä¿å­˜æˆåŠŸï¼');
                        clearForm();
                    })
                    .catch(error => {
                        console.error('ä¿å­˜å¤±è´¥:', error);
                        alert('ä¿å­˜å¤±è´¥: ' + error.message);
                    });
                    
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }
        */
       // ä¿®æ”¹ä¿å­˜åˆ°æ•°æ®åº“å‡½æ•°ï¼Œä½¿ç”¨å¢å¼ºçš„éªŒè¯
        function saveToDatabase() {
            const jsonData = validateJsonWithDetails();
            
            if (!jsonData) {
                alert('é”™è¯¯ï¼šæ•°æ®éªŒè¯å¤±è´¥ï¼Œæ— æ³•ä¿å­˜ã€‚');
                return;
            }
            
            try {
                // ç”Ÿæˆå”¯ä¸€ID
                const dataId = Date.now().toString();
                
                // å‡†å¤‡ä¿å­˜çš„æ•°æ®
                const saveData = {
                    ...jsonData,
                    _metadata: {
                        template: appState.currentTemplate,
                        createdAt: new Date().toISOString(),
                        createdBy: appState.currentUser.uid,
                        createdByName: appState.currentUser.displayName || appState.currentUser.email
                    }
                };
                
                // ä¿å­˜åˆ°Firebase
                database.ref(`ai-data/${appState.currentUser.uid}/${appState.currentTemplate}/${dataId}`)
                    .set(saveData)
                    .then(() => {
                        alert('æ•°æ®ä¿å­˜æˆåŠŸï¼');
                        clearForm();
                    })
                    .catch(error => {
                        console.error('ä¿å­˜å¤±è´¥:', error);
                        alert('ä¿å­˜å¤±è´¥: ' + error.message);
                    });
                    
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        // æ¸…é™¤è¡¨å•
        function clearForm() {
            // æ¸…é™¤è¾“å…¥å­—æ®µ
            const inputs = inputFields.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.tagName === 'SELECT') {
                    input.selectedIndex = 0;
                } else {
                    input.value = '';
                }
            });
            
            // æ¸…é™¤è¾“å‡ºåŒºåŸŸ
            aiOutput.value = '';
            
            // æ¸…é™¤éªŒè¯ç»“æœ
            clearValidation();
            
            // æ›´æ–°prompt
            updatePrompt();
        }

        // æ˜¾ç¤ºSchemaç®¡ç†å™¨
        function showSchemaManager() {
            consoleTitle.textContent = 'Schema ç®¡ç†';
            
            // ç”ŸæˆSchemaç®¡ç†ç•Œé¢
            inputFields.innerHTML = `
                <div class="form-group">
                    <h3>å½“å‰æ¨¡æ¿çš„Schema</h3>
                    <div id="schemaDisplay" class="json-container"></div>
                </div>
                <div class="form-group">
                    <h3>ç¼–è¾‘Schema</h3>
                    <textarea id="schemaEditor" class="form-control" rows="10" placeholder="åœ¨æ­¤ç¼–è¾‘JSON Schema..."></textarea>
                </div>
                <div class="action-buttons">
                    <button id="updateSchemaBtn" class="btn btn-primary">
                        <i class="fas fa-sync"></i> æ›´æ–°Schema
                    </button>
                </div>
            `;
            
            // æ˜¾ç¤ºå½“å‰æ¨¡æ¿çš„Schema
            const schemaDisplay = document.getElementById('schemaDisplay');
            const currentSchema = appState.templates[appState.currentTemplate].schema;
            schemaDisplay.textContent = JSON.stringify(currentSchema, null, 2);
            
            // åˆå§‹åŒ–ç¼–è¾‘å™¨
            const schemaEditor = document.getElementById('schemaEditor');
            schemaEditor.value = JSON.stringify(currentSchema, null, 2);
            
            // æ›´æ–°SchemaæŒ‰é’®äº‹ä»¶
            document.getElementById('updateSchemaBtn').addEventListener('click', updateSchema);
            
            // éšè—è¾“å‡ºåŒºåŸŸ
            document.querySelector('.output-section').style.display = 'none';
        }

        // æ›´æ–°Schema
        function updateSchema() {
            const schemaEditor = document.getElementById('schemaEditor');
            const schemaText = schemaEditor.value.trim();
            
            try {
                const newSchema = JSON.parse(schemaText);
                appState.templates[appState.currentTemplate].schema = newSchema;
                
                // æ›´æ–°æ˜¾ç¤º
                const schemaDisplay = document.getElementById('schemaDisplay');
                schemaDisplay.textContent = JSON.stringify(newSchema, null, 2);
                
                alert('Schemaæ›´æ–°æˆåŠŸï¼');
            } catch (error) {
                alert('Schemaæ›´æ–°å¤±è´¥: ' + error.message);
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        initApp();
    </script>
</body>
</html>