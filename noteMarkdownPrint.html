<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 打印格式化工具</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --light-gray: #f5f5f5;
            --border-color: #ddd;
            --text-color: #333;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f9f9f9;

            overflow-y: hidden;
        }
        
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;

            height:100vh;
            overflow-y: auto;
        }
        
        .controls-panel {
            flex: 0 0 300px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 40px);
        }
        
        .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .preview-container {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow: auto;
        }
        
        .preview-content {
            min-height: 600px;
            padding: 30px;
            background: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        
        h2 {
            margin: 25px 0 15px;
            color: var(--secondary-color);
        }
        
        .control-group {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .control-group:last-child {
            border-bottom: none;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        select, input, button {
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            background-color: var(--secondary-color);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .action-buttons button {
            flex: 1;
        }
        
        .css-editor {
            width: 100%;
            height: 120px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
            resize: vertical;
        }
        
        .page-break {
            position: relative;
            margin: 20px 0;
            border-top: 2px dashed #ccc;
            text-align: center;
        }
        
        .page-break::before {
            content: "分页符";
            background: white;
            padding: 0 10px;
            position: relative;
            top: -10px;
            color: #666;
            font-size: 12px;
        }
        
        /* 默认打印样式 */
        @media print {
            body * {
                visibility: hidden;
            }
            .preview-content, .preview-content * {
                visibility: visible;
            }
            .preview-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                padding: 0;
            }
            .page-break {
                page-break-before: always;
            }
        }
        
        /* 表格默认样式 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        /* 列表默认样式 */
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin-bottom: 5px;
        }
        
        /* 代码块样式 */
        pre {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        blockquote {
            border-left: 4px solid #ddd;
            padding-left: 15px;
            margin: 15px 0;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls-panel">
            <h1 style="font-size:24px;">打印格式化设置</h1>
            
            <div class="control-group">
                <h2 style="font-size:20px;">文档输入</h2>
                <label style="font-size:18px;" for="markdown-url">Markdown URL</label>
                <input type="text" id="markdown-url" placeholder="输入Markdown文档URL">
                <button id="load-markdown">加载文档</button>
                <button id="load-sample">加载示例文档</button>
            </div>
            
            <div class="control-group">
                <h2>基本设置</h2>
                <label for="font-family">字体</label>
                <select id="font-family">
                    <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI (默认)</option>
                    <option value="'Times New Roman', Times, serif">Times New Roman</option>
                    <option value="Arial, Helvetica, sans-serif">Arial</option>
                    <option value="'Courier New', Courier, monospace">Courier New</option>
                </select>
                
                <label for="font-size">字号</label>
                <select id="font-size">
                    <option value="12px">12px</option>
                    <option value="14px" selected>14px</option>
                    <option value="16px">16px</option>
                    <option value="18px">18px</option>
                </select>
                
                <label for="line-height">行距</label>
                <select id="line-height">
                    <option value="1.2">1.2</option>
                    <option value="1.4">1.4</option>
                    <option value="1.6" selected>1.6</option>
                    <option value="1.8">1.8</option>
                </select>
                
                <label for="margin">页边距</label>
                <select id="margin">
                    <option value="10mm">10mm</option>
                    <option value="15mm" selected>15mm</option>
                    <option value="20mm">20mm</option>
                    <option value="25mm">25mm</option>
                </select>
            </div>
            
            <div class="control-group">
                <h2>表格样式</h2>
                <label for="table-style">表格样式</label>
                <select id="table-style">
                    <option value="default" selected>默认样式</option>
                    <option value="minimal">简约样式</option>
                    <option value="bordered">边框样式</option>
                    <option value="striped">条纹样式</option>
                </select>
                
                <label for="table-font-size">表格字号</label>
                <select id="table-font-size">
                    <option value="12px">12px</option>
                    <option value="13px">13px</option>
                    <option value="14px" selected>14px</option>
                </select>
            </div>
            
            <div class="control-group">
                <h2>列表样式</h2>
                <label for="list-style">列表样式</label>
                <select id="list-style">
                    <option value="default" selected>默认样式</option>
                    <option value="compact">紧凑样式</option>
                    <option value="spacious">宽松样式</option>
                </select>
            </div>
            
            <div class="control-group">
                <h2>自定义CSS</h2>
                <label for="custom-css">自定义CSS规则</label>
                <textarea id="custom-css" class="css-editor" placeholder="输入自定义CSS规则，例如：h1 { color: red; }"></textarea>
                <button id="apply-css">应用CSS</button>
            </div>
            
            <div class="control-group">
                <h2>分页控制</h2>
                <p>点击文档中的任意元素，然后点击下方按钮在该元素前添加分页符</p>
                <button id="add-page-break">在选中元素前添加分页符</button>
                <button id="clear-page-breaks">清除所有分页符</button>
            </div>
            
            <div class="action-buttons">
                <button id="preview-print">打印预览</button>
                <button id="print-doc">打印文档</button>
            </div>
        </div>
        
        <div class="preview-panel">
            <h1 style="display: none;">打印预览</h1>
            <div class="preview-container">
                <div class="preview-content" id="preview-content">
                    <!-- Markdown内容将在这里渲染 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 示例Markdown文档
        const sampleMarkdown = `# Markdown 文档示例

这是一个示例Markdown文档，用于演示打印格式化工具的功能。

## 章节一：介绍

Markdown是一种轻量级标记语言，它允许人们使用易读易写的纯文本格式编写文档。

### 特点

- 简单易学
- 纯文本格式，兼容性强
- 可以转换为HTML等多种格式

## 章节二：表格示例

下面是一个简单的表格示例：

| 项目 | 数量 | 价格 |
|------|------|------|
| 苹果 | 10   | ¥5.00 |
| 香蕉 | 5    | ¥3.50 |
| 橙子 | 8    | ¥4.20 |

## 章节三：代码示例

以下是一个JavaScript代码示例：

\`\`\`javascript
function greet(name) {
    return \`Hello, \${name}!\`;
}

console.log(greet("World"));
\`\`\`

## 章节四：引用和强调

> 这是引用文本的示例。引用通常用于突出显示重要内容或引用他人的话语。

**粗体文本** 和 *斜体文本* 是常用的文本强调方式。

## 章节五：长内容测试

此处添加一些长内容以测试分页功能。

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.

Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.

Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.

Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.

Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur.

Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur.

## 章节六：有序列表

1. 第一项
2. 第二项
    - 嵌套无序列表项
    - 另一个嵌套项
3. 第三项

## 章节七：链接和图片

这是一个[链接示例](https://example.com)。

![图片示例](https://via.placeholder.com/150)

---

文档结束。`;

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const previewContent = document.getElementById('preview-content');
            const markdownUrlInput = document.getElementById('markdown-url');
            const loadMarkdownBtn = document.getElementById('load-markdown');
            const loadSampleBtn = document.getElementById('load-sample');
            const fontFamilySelect = document.getElementById('font-family');
            const fontSizeSelect = document.getElementById('font-size');
            const lineHeightSelect = document.getElementById('line-height');
            const marginSelect = document.getElementById('margin');
            const tableStyleSelect = document.getElementById('table-style');
            const tableFontSizeSelect = document.getElementById('table-font-size');
            const listStyleSelect = document.getElementById('list-style');
            const customCssTextarea = document.getElementById('custom-css');
            const applyCssBtn = document.getElementById('apply-css');
            const addPageBreakBtn = document.getElementById('add-page-break');
            const clearPageBreaksBtn = document.getElementById('clear-page-breaks');
            const previewPrintBtn = document.getElementById('preview-print');
            const printDocBtn = document.getElementById('print-doc');
            
            let selectedElement = null;
            
            // 从URL参数获取Markdown文档URL
            const urlParams = new URLSearchParams(window.location.search);
            const markdownUrl = urlParams.get('url');
            if (markdownUrl) {
                markdownUrlInput.value = markdownUrl;
                loadMarkdownFromUrl(markdownUrl);
            } else {
                // 默认加载示例文档
                renderMarkdown(sampleMarkdown);
            }
            
            // 事件监听器
            loadMarkdownBtn.addEventListener('click', function() {
                const url = markdownUrlInput.value;
                if (url) {
                    loadMarkdownFromUrl(url);
                } else {
                    alert('请输入Markdown文档的URL');
                }
            });
            
            loadSampleBtn.addEventListener('click', function() {
                renderMarkdown(sampleMarkdown);
            });
            
            // 样式控制事件
            fontFamilySelect.addEventListener('change', updateStyles);
            fontSizeSelect.addEventListener('change', updateStyles);
            lineHeightSelect.addEventListener('change', updateStyles);
            marginSelect.addEventListener('change', updateStyles);
            tableStyleSelect.addEventListener('change', updateTableStyles);
            tableFontSizeSelect.addEventListener('change', updateTableStyles);
            listStyleSelect.addEventListener('change', updateListStyles);
            
            applyCssBtn.addEventListener('click', function() {
                applyCustomCss();
            });
            
            // 分页功能
            previewContent.addEventListener('click', function(e) {
                if (e.target !== previewContent) {
                    // 移除之前选中的元素的高亮
                    if (selectedElement) {
                        selectedElement.style.outline = '';
                    }
                    
                    // 高亮当前选中的元素
                    selectedElement = e.target;
                    selectedElement.style.outline = '2px solid #3498db';
                }
            });
            
            addPageBreakBtn.addEventListener('click', function() {
                if (selectedElement) {
                    const pageBreak = document.createElement('div');
                    pageBreak.className = 'page-break';
                    selectedElement.parentNode.insertBefore(pageBreak, selectedElement);
                    
                    // 移除高亮
                    selectedElement.style.outline = '';
                    selectedElement = null;
                } else {
                    alert('请先点击要分页的元素');
                }
            });
            
            clearPageBreaksBtn.addEventListener('click', function() {
                const pageBreaks = document.querySelectorAll('.page-break');
                pageBreaks.forEach(breakEl => breakEl.remove());
            });
            
            // 打印功能
            previewPrintBtn.addEventListener('click', function() {
                window.print();
            });
            
            printDocBtn.addEventListener('click', function() {
                window.print();
            });
            
            // 从URL加载Markdown文档
            function loadMarkdownFromUrl(url) {
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('网络响应不正常');
                        }
                        return response.text();
                    })
                    .then(markdown => {
                        renderMarkdown(markdown);
                    })
                    .catch(error => {
                        console.error('加载Markdown文档时出错:', error);
                        alert('加载文档失败，请检查URL是否正确');
                    });
            }
            
            // 渲染Markdown内容
            function renderMarkdown(markdown) {
                // 使用marked.js解析Markdown
                const html = marked.parse(markdown);
                previewContent.innerHTML = html;
                
                // 应用当前样式设置
                updateStyles();
                updateTableStyles();
                updateListStyles();
                applyCustomCss();
            }
            
            // 更新基本样式
            function updateStyles() {
                const fontFamily = fontFamilySelect.value;
                const fontSize = fontSizeSelect.value;
                const lineHeight = lineHeightSelect.value;
                const margin = marginSelect.value;
                
                previewContent.style.fontFamily = fontFamily;
                previewContent.style.fontSize = fontSize;
                previewContent.style.lineHeight = lineHeight;
                previewContent.style.padding = margin;
            }
            
            // 更新表格样式
            function updateTableStyles() {
                const tableStyle = tableStyleSelect.value;
                const tableFontSize = tableFontSizeSelect.value;
                
                const tables = previewContent.querySelectorAll('table');
                tables.forEach(table => {
                    table.style.fontSize = tableFontSize;
                    
                    // 重置表格样式
                    table.style.borderCollapse = 'collapse';
                    table.style.width = '100%';
                    
                    const thCells = table.querySelectorAll('th');
                    const tdCells = table.querySelectorAll('td');
                    
                    // 根据选择的样式应用不同的表格样式
                    switch(tableStyle) {
                        case 'minimal':
                            thCells.forEach(th => {
                                th.style.border = 'none';
                                th.style.borderBottom = '1px solid #ddd';
                                th.style.background = 'transparent';
                                th.style.padding = '8px 5px';
                            });
                            
                            tdCells.forEach(td => {
                                td.style.border = 'none';
                                td.style.borderBottom = '1px solid #eee';
                                td.style.padding = '8px 5px';
                            });
                            break;
                            
                        case 'bordered':
                            thCells.forEach(th => {
                                th.style.border = '1px solid #333';
                                th.style.background = '#f2f2f2';
                                th.style.padding = '10px';
                            });
                            
                            tdCells.forEach(td => {
                                td.style.border = '1px solid #333';
                                td.style.padding = '10px';
                            });
                            break;
                            
                        case 'striped':
                            thCells.forEach(th => {
                                th.style.border = '1px solid #ddd';
                                th.style.background = '#f2f2f2';
                                th.style.padding = '10px';
                            });
                            
                            tdCells.forEach(td => {
                                td.style.border = '1px solid #ddd';
                                td.style.padding = '10px';
                            });
                            
                            // 添加斑马纹
                            const rows = table.querySelectorAll('tr');
                            rows.forEach((row, index) => {
                                if (index % 2 === 0 && index > 0) {
                                    row.style.background = '#f9f9f9';
                                }
                            });
                            break;
                            
                        default: // default样式
                            thCells.forEach(th => {
                                th.style.border = '1px solid #ddd';
                                th.style.background = '#f2f2f2';
                                th.style.padding = '10px';
                                th.style.fontWeight = 'bold';
                            });
                            
                            tdCells.forEach(td => {
                                td.style.border = '1px solid #ddd';
                                td.style.padding = '10px';
                            });
                    }
                });
            }
            
            // 更新列表样式
            function updateListStyles() {
                const listStyle = listStyleSelect.value;
                
                const lists = previewContent.querySelectorAll('ul, ol');
                lists.forEach(list => {
                    switch(listStyle) {
                        case 'compact':
                            list.style.margin = '10px 0';
                            list.style.paddingLeft = '20px';
                            
                            const listItems = list.querySelectorAll('li');
                            listItems.forEach(li => {
                                li.style.marginBottom = '2px';
                                li.style.padding = '2px 0';
                            });
                            break;
                            
                        case 'spacious':
                            list.style.margin = '20px 0';
                            list.style.paddingLeft = '40px';
                            
                            const spaciousItems = list.querySelectorAll('li');
                            spaciousItems.forEach(li => {
                                li.style.marginBottom = '10px';
                                li.style.padding = '5px 0';
                            });
                            break;
                            
                        default: // default样式
                            list.style.margin = '15px 0';
                            list.style.paddingLeft = '30px';
                            
                            const defaultItems = list.querySelectorAll('li');
                            defaultItems.forEach(li => {
                                li.style.marginBottom = '5px';
                            });
                    }
                });
            }
            
            // 应用自定义CSS
            function applyCustomCss() {
                const customCss = customCssTextarea.value;
                
                // 移除之前添加的自定义样式
                const existingStyle = document.getElementById('custom-css-style');
                if (existingStyle) {
                    existingStyle.remove();
                }
                
                if (customCss.trim() !== '') {
                    // 创建新的style元素并添加自定义CSS
                    const style = document.createElement('style');
                    style.id = 'custom-css-style';
                    style.textContent = customCss;
                    document.head.appendChild(style);
                }
            }
        });
    </script>
</body>
</html>